import{L as e,R as t,T as n,c as r,f as i,h as a,j as o,m as s,n as c,o as l,p as u,t as d,u as f}from"./app-DvX1Smg_.js";import"./isObject-STXFNBUz.js";import"./isSymbol-CUbBZ03s.js";import"./toNumber-CiYTsHHK.js";import"./now-BXsIGwzm.js";import{n as p,t as m}from"./toc-DNILfFl5.js";import{n as h,t as g}from"./meta-info-C-tMy3g2.js";import{t as _}from"./use-page-title-CHxbaOlI.js";var v={class:`relative`},y={key:0,class:`mt-10`},b=l(Object.assign({name:`Article`},{__name:`vm:_post_ime-and-keydown-event_`,setup(l){_({title:`输入法与 keydown 事件`,description:``});let{meta:b,toc:x}={meta:{title:`输入法与 keydown 事件`,date:`2022-10-20T17:01:39.000Z`,categories:[`前端`],id:`ime-and-keydown-event`,keywords:[`input`,`ime`,`input-method editor`,`keydown event`,`用户体验`],tags:[],sort:0,comments:!0,draft:!1},toc:[{id:`%E7%9B%91%E5%90%AC%E5%9B%9E%E8%BD%A6`,text:`监听回车`,level:2,children:[],parent:``},{id:`%E5%85%B3%E4%BA%8E%E5%BA%9F%E5%BC%83%E7%9A%84%20keyCode`,text:`关于废弃的 keyCode`,level:2,children:[],parent:``},{id:`%E6%96%87%E6%9C%AC%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6`,text:`文本合成事件`,level:2,children:[],parent:``},{id:`%E7%BB%93%E8%AF%AD`,text:`结语`,level:2,children:[],parent:``}]},{appState:S}=d();return(l,d)=>(n(),u(r,null,[f(`div`,v,[f(`article`,null,[f(`header`,null,[d[1]||=f(`h1`,{class:`text-foreground text-3xl font-bold mb-4`},` 输入法与 keydown 事件 `,-1),a(g,{meta:e(b)},null,8,[`meta`])]),a(h,{class:`mt-6`},{default:o(()=>[d[4]||=f(`p`,null,`输入、回车提交，这是一组在搜索场景中常见、友好的交互形式，但要将其做好以获得更好的用户体验，还需要关注其中的小小细节。`,-1),d[5]||=f(`a`,{id:`more`,href:`#more`,class:`block`},null,-1),d[6]||=f(`h2`,{id:`%E7%9B%91%E5%90%AC%E5%9B%9E%E8%BD%A6`},[s(`监听回车`),f(`a`,{name:`%E7%9B%91%E5%90%AC%E5%9B%9E%E8%BD%A6`,class:`headerlink`,href:`#%E7%9B%91%E5%90%AC%E5%9B%9E%E8%BD%A6`})],-1),d[7]||=f(`p`,null,`所谓的细节就是关于“回车”的监听。因为输入法的存在，引入了文本合成现象，使得字符输入变得不再纯粹简单。`,-1),d[8]||=f(`p`,null,`若处理不当，就会出现在开着输入法的情况下，当只想使用回车输入字符时，却触发了提交动作。`,-1),d[9]||=f(`p`,null,`就像这样：`,-1),d[10]||=f(`p`,null,[f(`img`,{alt:`github-search.webp`,loading:`lazy`,title:`github-search.webp`,class:`post-image`,src:`/assets/github-search-CZrsS3Nr.webp`,onerror:`this.onerror=null;this.src='/images/image-error.jpg';`})],-1),d[11]||=f(`p`,null,`大胆猜想一下，上面输入框的实现可能是这样的：`,-1),d[12]||=f(`pre`,{class:`shiki shiki-themes min-light night-owl`,style:{"--shiki-light":`#24292eff`,"--shiki-dark":`#d6deeb`,"--shiki-light-bg":`#ffffff`,"--shiki-dark-bg":`#011627`},tabindex:`0`},[f(`code`,null,[f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#1976D2`,"--shiki-dark":`#D6DEEB`}},`input`),f(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#C792EA`,"--shiki-dark-font-style":`italic`}},`.`),f(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#82AAFF`,"--shiki-dark-font-style":`italic`}},`addEventListener`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`(`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},`'`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#ECC48D`}},`keydown`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},`'`),f(`span`,{style:{"--shiki-light":`#212121`,"--shiki-dark":`#D6DEEB`}},`,`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D9F5DD`}},` (`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D7DBE0`}},`e`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D9F5DD`}},`)`),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#C792EA`}},` =>`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},` {`)]),s(`
`),f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#C792EA`}},`  if`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},` (`),f(`span`,{style:{"--shiki-light":`#1976D2`,"--shiki-dark":`#D6DEEB`}},`e`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#C792EA`,"--shiki-dark-font-style":`italic`}},`.`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#BAEBE2`}},`code`),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#C792EA`}},` !==`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},` '`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#ECC48D`}},`Enter`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},`'`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`) `),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#C792EA`,"--shiki-dark-font-style":`italic`}},`return`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`;`)]),s(`
`),f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#C2C3C5`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#637777`,"--shiki-dark-font-style":`italic`}},`  // ... submit`)]),s(`
`),f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`});`)])])],-1),d[13]||=f(`p`,null,`问题的原因就很明显了，需要在判断回车的时候，考虑一下用户的输入模式。那么问题来了，如何区分用户是否处于输入法模式呢，又或者说是处于文本合成事件当中？`,-1),d[14]||=f(`p`,null,[s(`回到 `),f(`code`,null,`keydown`),s(` 事件，探究 KeyboardEvent 对象上的几个属性：`)],-1),d[15]||=f(`ul`,null,[f(`li`,null,`charCode：已废弃，Edge 106.0.1370.47 上读取的值总是 0`),f(`li`,null,`code：表示键盘上的物理键，该值不会被键盘布局或修饰键的状态改变，例如有 ShiftLeft、Digit3、KeyD`),f(`li`,null,[s(`key：用户按下的物理按键的值，与 `),f(`code`,null,`shiftKey`),s(` 等调节性按键的状态和键盘的区域 / 和布局有关，例如有 D、d、shift、3、#`)]),f(`li`,null,`keyCode：已废弃，Edge 106.0.1370.47 上还能使用`),f(`li`,null,`isComposing：表示事件是否处于文本合成事件之间`)],-1),d[16]||=f(`p`,null,[f(`img`,{alt:`keydown.webp`,loading:`lazy`,title:`keydown.webp`,class:`post-image`,src:`/assets/keydown-CELs4nrz.webp`,onerror:`this.onerror=null;this.src='/images/image-error.jpg';`})],-1),d[17]||=f(`p`,null,[s(`有了上述信息，结合 `),f(`code`,null,`isComposing`),s(` 就能很容易地判断出是否处于输入法模式了：`)],-1),d[18]||=f(`pre`,{class:`shiki shiki-themes min-light night-owl`,style:{"--shiki-light":`#24292eff`,"--shiki-dark":`#d6deeb`,"--shiki-light-bg":`#ffffff`,"--shiki-dark-bg":`#011627`},tabindex:`0`},[f(`code`,null,[f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#1976D2`,"--shiki-dark":`#D6DEEB`}},`input`),f(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#C792EA`,"--shiki-dark-font-style":`italic`}},`.`),f(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#82AAFF`,"--shiki-dark-font-style":`italic`}},`addEventListener`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`(`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},`'`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#ECC48D`}},`keydown`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},`'`),f(`span`,{style:{"--shiki-light":`#212121`,"--shiki-dark":`#D6DEEB`}},`,`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D9F5DD`}},` (`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D7DBE0`}},`e`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D9F5DD`}},`)`),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#C792EA`}},` =>`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},` {`)]),s(`
`),f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#C792EA`}},`  if`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},` (`),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#C792EA`}},`!`),f(`span`,{style:{"--shiki-light":`#1976D2`,"--shiki-dark":`#D6DEEB`}},`e`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#C792EA`,"--shiki-dark-font-style":`italic`}},`.`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#BAEBE2`}},`isComposing`),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#C792EA`}},` &&`),f(`span`,{style:{"--shiki-light":`#1976D2`,"--shiki-dark":`#D6DEEB`}},` e`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#C792EA`,"--shiki-dark-font-style":`italic`}},`.`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#BAEBE2`}},`code`),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#C792EA`}},` ===`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},` '`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#ECC48D`}},`Enter`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},`'`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`) {`)]),s(`
`),f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#C2C3C5`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#637777`,"--shiki-dark-font-style":`italic`}},`    // ... submit`)]),s(`
`),f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`  }`)]),s(`
`),f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`});`)])])],-1),d[19]||=f(`p`,null,`如此一来，搜索场景的用户体验就能做到完善了。`,-1),d[20]||=f(`h2`,{id:`%E5%85%B3%E4%BA%8E%E5%BA%9F%E5%BC%83%E7%9A%84%20keyCode`},[s(`关于废弃的 keyCode`),f(`a`,{name:`%E5%85%B3%E4%BA%8E%E5%BA%9F%E5%BC%83%E7%9A%84%20keyCode`,class:`headerlink`,href:`#%E5%85%B3%E4%BA%8E%E5%BA%9F%E5%BC%83%E7%9A%84%20keyCode`})],-1),d[21]||=f(`p`,null,`keyCode 虽然被标记为废弃、原则上不应再去用，但依旧有在被使用（比如别人写的代码），所以需要具备一些相关的知识。`,-1),d[22]||=f(`p`,null,`简单来说，keyCode 是键盘字符映射的一个数字值，而 keyCode 被废弃的原因大概是某些键的映射值表现不一吧，比如在不同浏览器上会有值不同的情况。`,-1),d[23]||=f(`p`,null,[s(`另外，keyCode 还有一个魔法值：`),f(`code`,null,`229`),s(`，表示正处于文本合成事件当中。`)],-1),d[24]||=f(`h2`,{id:`%E6%96%87%E6%9C%AC%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6`},[s(`文本合成事件`),f(`a`,{name:`%E6%96%87%E6%9C%AC%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6`,class:`headerlink`,href:`#%E6%96%87%E6%9C%AC%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6`})],-1),d[25]||=f(`p`,null,`浏览器有专门的文本合成事件用于监听，即：`,-1),d[26]||=f(`ul`,null,[f(`li`,null,`compositionstart`),f(`li`,null,`compositionupdate`),f(`li`,null,`compositionend`)],-1),d[27]||=f(`p`,null,`通过该事件可获取处于合成事件中的文本，即输入法正在键入的字符：`,-1),d[28]||=f(`pre`,{class:`shiki shiki-themes min-light night-owl`,style:{"--shiki-light":`#24292eff`,"--shiki-dark":`#d6deeb`,"--shiki-light-bg":`#ffffff`,"--shiki-dark-bg":`#011627`},tabindex:`0`},[f(`code`,null,[f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#1976D2`,"--shiki-dark":`#D6DEEB`}},`input`),f(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#C792EA`,"--shiki-dark-font-style":`italic`}},`.`),f(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#82AAFF`,"--shiki-dark-font-style":`italic`}},`addEventListener`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`(`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},`'`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#ECC48D`}},`compositionupdate`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D9F5DD`}},`'`),f(`span`,{style:{"--shiki-light":`#212121`,"--shiki-dark":`#D6DEEB`}},`,`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D9F5DD`}},` (`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D7DBE0`}},`event`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D9F5DD`}},`)`),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#C792EA`}},` =>`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},` {`)]),s(`
`),f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#1976D2`,"--shiki-dark":`#D6DEEB`}},`  console`),f(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#C792EA`,"--shiki-dark-font-style":`italic`}},`.`),f(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#82AAFF`,"--shiki-dark-font-style":`italic`}},`log`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`(`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D6DEEB`}},"`"),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#ECC48D`}},`characters: `),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#D3423E`}},"${"),f(`span`,{style:{"--shiki-light":`#1976D2`,"--shiki-dark":`#D6DEEB`}},`event`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-light-font-style":`inherit`,"--shiki-dark":`#C792EA`,"--shiki-dark-font-style":`italic`}},`.`),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#BAEBE2`}},`data`),f(`span`,{style:{"--shiki-light":`#D32F2F`,"--shiki-dark":`#D3423E`}},`}`),f(`span`,{style:{"--shiki-light":`#22863A`,"--shiki-dark":`#D6DEEB`}},"`"),f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`);`)]),s(`
`),f(`span`,{class:`line`},[f(`span`,{style:{"--shiki-light":`#24292EFF`,"--shiki-dark":`#D6DEEB`}},`});`)])])],-1),d[29]||=f(`h2`,{id:`%E7%BB%93%E8%AF%AD`},[s(`结语`),f(`a`,{name:`%E7%BB%93%E8%AF%AD`,class:`headerlink`,href:`#%E7%BB%93%E8%AF%AD`})],-1),d[30]||=f(`p`,null,`简单介绍了与输入法相关的一些事件使用，简单的交互背后也有他的细节，做好了细节才能将一件事做到尽善尽美。`,-1),d[31]||=f(`p`,null,`相关资料：`,-1),f(`ul`,null,[f(`li`,null,[a(c,{target:`_blank`,href:`https://developer.mozilla.org/zh-CN/docs/Web/API/Element/keydown_event`},{default:o(()=>[...d[2]||=[s(`Element: 键盘按下事件`,-1)]]),_:1})]),f(`li`,null,[a(c,{target:`_blank`,href:`https://developer.mozilla.org/zh-CN/docs/Web/API/KeyboardEvent`},{default:o(()=>[...d[3]||=[s(`KeyboardEvent`,-1)]]),_:1})])])]),_:1})]),e(x).length?(n(),u(`aside`,{key:0,class:t([e(S).showIndexSidebar?`bg-[#00000080]`:`pointer-events-none`,`fixed z-20 top-0 w-full h-full left-0 overscroll-contain transition-300`,`lg:pointer-events-auto`,`lg:absolute lg:w-auto lg:bg-transparent lg:left-[calc(100%+clamp(6px,17.1875vw-176px,50px))]`]),onClick:d[0]||=(...e)=>l.hideIndexSidebar&&l.hideIndexSidebar(...e)},[f(`nav`,{class:t([`overflow-y-auto text-foreground overscroll-contain bg-background`,`w-74 max-w-4/5 h-full py-8 px-6 rounded-tl-xl rounded-bl-xl`,`absolute top-0 transition-300 right-0`,e(S).showIndexSidebar?`translate-x-0`:`translate-x-full`,`lg:p-0 lg:max-w-44 xl:max-w-50 lg:h-auto lg:max-h-[calc(100vh-130px)] lg:rounded-none`,`lg:sticky lg:top-10 lg:right-auto lg:translate-x-0 lg:bg-transparent lg:ml-0`])},[d[32]||=f(`h2`,{class:`mb-2 font-bold lg:hidden`},`TABLE OF CONTENTS`,-1),a(m,{toc:e(x)},null,8,[`toc`])],2)],2)):i(``,!0)]),d[33]||=f(`hr`,{class:`border-border mt-10`},null,-1),e(b).comments?(n(),u(`div`,y,[a(p)])):i(``,!0)],64))}}),[[`__scopeId`,`data-v-b8f49024`]]);export{b as default};