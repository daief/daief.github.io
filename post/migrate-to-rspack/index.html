<!DOCTYPE html><html ssthtmlattrs="" lang="en"><head>
    <title>从 Webpack 迁移到 Rspack 的实践记录 | Daief's Blog</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--ssr-head-partial-->
    <script>
      if (/MSIE \d|Trident.*rv:/.test(navigator.userAgent)) {
        // redirect IE to Edge
        // This browser is no longer supported
        window.location.href = 'microsoft-edge:' + window.location.href;
        alert('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
        throw new Error('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
      }
    </script>
    <script type="module" crossorigin="" src="/assets/app-DvX1Smg_.js"></script>
    <link rel="stylesheet" crossorigin="" href="/assets/app-lBf8QYnm.css">
  <link rel="modulepreload" crossorigin="" href="/assets/vm__post_migrate-to-rspack_-BQ-5tHNg.js"><link rel="stylesheet" href="/assets/vm__post_migrate-to-rspack_-_WcETx5i.css"><link rel="modulepreload" crossorigin="" href="/assets/meta-info-C-tMy3g2.js"><link rel="modulepreload" crossorigin="" href="/assets/toc-DNILfFl5.js"><link rel="stylesheet" href="/assets/toc-m8VwwUnR.css"><meta name="description" content=""><meta property="og:title" content="从 Webpack 迁移到 Rspack 的实践记录 | Daief's Blog"><meta property="og:description" content=""><meta property="og:image" content="https://avatars.githubusercontent.com/u/19222089?v=4"><meta name="author" content="daief"></head>
  <body ssrbodyattrs="">
    <div class="page-bg-gradient pointer-events-none fixed start-0 top-0 z-[-1] h-screen w-full"></div>
    <div id="app" data-server-rendered="true"><!--[--><div class="flex flex-col min-h-screen transition-colors duration-300"><header data-v-c69b61b1=""><div id="nav-container" class="max-w-app mx-auto text-foreground sm:bg-transparent" data-v-c69b61b1=""><div id="top-nav-wrap" class="relative grid grid-cols-2 auto-rows-auto w-full items-center justify-between p-4 sm:py-6 sm:flex sm:grid-rows-1" data-v-c69b61b1=""><a href="/" class="py-1 text-xl leading-8 font-semibold whitespace-nowrap sm:my-auto sm:text-2xl sm:leading-none" data-v-c69b61b1=""><!--[-->Daief's Blog<!--]--></a><div class="flex-center justify-end space-x-4 sm:hidden" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button><a role="button" class="text-2xl p-1" data-v-c69b61b1=""><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em" data-v-c69b61b1=""><path fill="currentColor" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg></a></div><nav id="nav-menu" class="col-start-1 col-end-3 w-full flex-col items-center static top-full left-0 right-0 z-10 mt-4 sm:mt-0 sm:ms-2 sm:flex-row sm:justify-end sm:space-x-4 sm:py-0 sm:flex hidden" data-v-c69b61b1=""><ul id="menu-items" class="w-full place-content-center gap-2 sm:flex sm:w-auto sm:gap-x-5 sm:gap-y-0" data-v-c69b61b1=""><!--[--><li class="col-span-2" data-v-c69b61b1=""><a href="/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1 nav-active" data-v-c69b61b1=""><!--[-->文章<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/tags/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->标签<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/about/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->关于<!--]--></a></li><!--]--><li class="col-span-1 hidden sm:block" data-v-c69b61b1=""><a class="flex justify-center items-center h-full px-4 py-3 sm:px-2 sm:py-1" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button></a></li></ul></nav></div></div><div class="mx-auto max-w-app px-4" data-v-c69b61b1=""><hr class="border-border" aria-hidden="true" data-v-c69b61b1=""></div></header><main class="flex-grow max-w-app mx-auto px-4 py-8 w-full text-foreground"><!--[--><div class="relative" data-v-c824d553=""><article data-v-c824d553=""><header data-v-c824d553=""><h1 class="text-foreground text-3xl font-bold mb-4" data-v-c824d553=""> 从 Webpack 迁移到 Rspack 的实践记录 </h1><div class="flex items-center gap-x-3.5 gap-y-0.5 text-foreground opacity-80 flex-wrap" data-v-c824d553=""><!--[--><!--[--><div class="inline-flex items-center gap-x-0.5 whitespace-nowrap"><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M7 11h2v2H7zm14-6v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2M5 7h14V5H5zm14 12V9H5v10zm-4-6v-2h2v2zm-4 0v-2h2v2zm-4 2h2v2H7zm8 2v-2h2v2zm-4 0v-2h2v2z"></path></svg><span>发表于：<time datetime="2025-11-22T21:58:16.000Z">2025/11/22</time></span></div><!--[--><a href="/tags/Rspack/1/" class="inline-flex items-center foreground-link"><svg class="iconify-svg block select-none mr-0.5 text-foreground" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="m5.41 21l.71-4h-4l.35-2h4l1.06-6h-4l.35-2h4l.71-4h2l-.71 4h6l.71-4h2l-.71 4h4l-.35 2h-4l-1.06 6h4l-.35 2h-4l-.71 4h-2l.71-4h-6l-.71 4zM9.53 9l-1.06 6h6l1.06-6z"></path></svg>Rspack</a><!--]--><!--]--><!--]--></div></header><div class="md-prose max-w-none dark:prose-invert mt-6" data-v-c824d553=""><!--[--><p data-v-c824d553="">过去一段时间给一些前端项目做了改造，把构建器从 Webpack4/5 迁移到了 <a href="https://rspack.rs/" target="_blank" class="" data-v-c824d553=""><!--[-->Rspack<!--]--></a>，大部分项目迁移完后，都减少了 <strong data-v-c824d553="">50%</strong> 以上的构建时间，整体改善还是可观的。</p><p data-v-c824d553="">选择 Rspack 另一方面的原因是它和 Webpack 兼容性较好，迁移成本相对较低，目前是一个非常推荐去尝试的构建器。笔者作为基建方，需要尽可能在底层做到最大的兼容，实际迁移过程中还是不可避免地遇到了一些问题，本文进行一个记录和分享。</p><a id="more" href="#more" class="block" data-v-c824d553=""></a><h2 id="Babel%20%E8%BF%81%E7%A7%BB%E5%88%B0%20SWC" data-v-c824d553="">Babel 迁移到 SWC<a name="Babel%20%E8%BF%81%E7%A7%BB%E5%88%B0%20SWC" class="headerlink" href="#Babel%20%E8%BF%81%E7%A7%BB%E5%88%B0%20SWC" data-v-c824d553=""></a></h2><p data-v-c824d553="">Rspack 内置了 <a href="https://swc.rs/" target="_blank" class="" data-v-c824d553=""><!--[-->SWC<!--]--></a> 作为默认的 JS/TS 转译器，理想状态下应该要直接替换掉 Babel，这是对构建速度影响最大的环节之一。</p><p data-v-c824d553="">而能否顺利地完全迁移到 SWC，实际上取决于 SWC 的生态给不给力。不幸的是，当前生态还不够完善、不能直接让我完全从 Babel 转向 SWC。下面分享几个（类）我对 Babel 插件的处理。</p><h3 id="babel-plugin-react-css-modules" data-v-c824d553=""><a href="https://www.npmjs.com/package/babel-plugin-react-css-modules" target="_blank" class="" data-v-c824d553=""><!--[-->babel-plugin-react-css-modules<!--]--></a><a name="babel-plugin-react-css-modules" class="headerlink" href="#babel-plugin-react-css-modules" data-v-c824d553=""></a></h3><p data-v-c824d553="">目前 SWC 生态中并没有对应的插件，这驱动了我自己去用 Rust 复刻了一个 SWC 版本的插件，也是我在迁移中比较有技术挑战的一个点。具体的插件实现后续会单独写一篇文章来介绍，之后同时也打算整理一个开源版本。</p><h3 id="babel-plugin-jsx-control-statements" data-v-c824d553=""><a href="https://www.npmjs.com/package/babel-plugin-jsx-control-statements" target="_blank" class="" data-v-c824d553=""><!--[-->babel-plugin-jsx-control-statements<!--]--></a><a name="babel-plugin-jsx-control-statements" class="headerlink" href="#babel-plugin-jsx-control-statements" data-v-c824d553=""></a></h3><p data-v-c824d553="">可以使用 SWC 版本的 <a href="https://github.com/intpp/swc-plugin-jsx-control-statements" target="_blank" class="" data-v-c824d553=""><!--[-->swc-plugin-jsx-control-statements<!--]--></a>，<strong data-v-c824d553="">但是</strong>，Rspack 中会有一种避免作用域冲突的机制，会自动对变量进行重命名，导致这个 SWC 插件的 <code data-v-c824d553="">For</code> 标签在 Rspack 中表现异常，具体如下：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// input.js</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-c824d553="">&lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-c824d553="">For</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-c824d553=""> each</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">=</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">item</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-c824d553=""> index</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">=</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">i</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-c824d553=""> of</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-c824d553="">{</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553="">list</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-c824d553="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-c824d553="">&gt;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-c824d553="">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#CAECE6;" data-v-c824d553="">div</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-c824d553="">&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-c824d553="">{</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-c824d553="">item</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-c824d553="">xxx</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-c824d553="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-c824d553="">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#CAECE6;" data-v-c824d553="">div</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-c824d553="">&gt;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-c824d553="">&lt;/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-c824d553="">For</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-c824d553="">&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// output.js</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-c824d553="">list</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553="">map</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">function</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553="">item1</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553=""> /* ❌ 这里期望的 item 被重命名成了 item1 */</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">  return</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-c824d553=""> item</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-c824d553="">xxx</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">; </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// 导致这里出现 Cannot read properties of undefined (reading xxx)</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">});</span></span></code></pre><p data-v-c824d553="">目前打了一个补丁来解决，但未能覆盖所有场景，详见 <a href="https://github.com/intpp/swc-plugin-jsx-control-statements/pull/9" target="_blank" class="" data-v-c824d553=""><!--[-->PR#9<!--]--></a>。在原作者未接受前，我发布了一个临时版本的包 <a href="https://www.npmjs.com/package/@axew/swc-plugin-jsx-control-statements" target="_blank" class="" data-v-c824d553=""><!--[-->@axew/swc-plugin-jsx-control-statements<!--]--></a>。</p><h3 id="proposal%20%E7%B3%BB%E5%88%97%E6%8F%92%E4%BB%B6" data-v-c824d553="">proposal 系列插件<a name="proposal%20%E7%B3%BB%E5%88%97%E6%8F%92%E4%BB%B6" class="headerlink" href="#proposal%20%E7%B3%BB%E5%88%97%E6%8F%92%E4%BB%B6" data-v-c824d553=""></a></h3><p data-v-c824d553="">比如 <code data-v-c824d553="">@babel/plugin-proposal-object-rest-spread</code>，这部分比较好处理，我的选择是舍弃，毕竟大部分已经是语言标准了，直接依托 SWC 所覆盖到的语法即可。不建议去使用太新、不稳定的语法特性。</p><h2 id="TypeScript%20%E8%BF%81%E7%A7%BB" data-v-c824d553="">TypeScript 迁移<a name="TypeScript%20%E8%BF%81%E7%A7%BB" class="headerlink" href="#TypeScript%20%E8%BF%81%E7%A7%BB" data-v-c824d553=""></a></h2><p data-v-c824d553="">对于 TS 的迁移，有一些不兼容的点需要格外关注，官方文档中也有明确提出：<a href="https://swc.rs/docs/migrating-from-tsc" target="_blank" class="" data-v-c824d553=""><!--[-->Migrating from tsc<!--]--></a>。</p><p data-v-c824d553="">本质上是因为 SWC 在某种程度上类似 <a href="https://babeljs.io/docs/babel-plugin-transform-typescript" target="_blank" class="" data-v-c824d553=""><!--[-->babel-plugin-transform-typescript<!--]--></a>，都是单文件转换（File-by-File Transformation）、无法处理任何需要理解完整类型系统的代码转换。</p><p data-v-c824d553="">因此，如果迁移前是使用 <code data-v-c824d553="">ts-loader</code> 这种基于 <code data-v-c824d553="">tsc</code> 完成编译的项目，更需要关注迁移手册中的注意点。在这种情况下 SWC 编译不会报错，只会编译出不同的产物、可能的错误问题只会在运行时才暴露。</p><p data-v-c824d553="">下面描述两个具体的案例来辅助说明。</p><h3 id="%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%AE%9A%E4%B9%89%E7%9A%84%E5%9C%BA%E6%99%AF" data-v-c824d553="">类属性定义的场景<a name="%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%AE%9A%E4%B9%89%E7%9A%84%E5%9C%BA%E6%99%AF" class="headerlink" href="#%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%AE%9A%E4%B9%89%E7%9A%84%E5%9C%BA%E6%99%AF" data-v-c824d553=""></a></h3><p data-v-c824d553="">对类、继承和装饰器涉及的项目，建议根据原始 <a href="https://www.typescriptlang.org/tsconfig/#useDefineForClassFields" target="_blank" class="" data-v-c824d553=""><!--[-->TS 配置中的行为<!--]--></a>明确指定 <code data-v-c824d553="">useDefineForClassFields</code> 的值，确保迁移后的行为与迁移前一致。比如有下面这样的继承案例：</p><p data-v-c824d553=""><code data-v-c824d553="">source.ts</code>：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-c824d553=""> A</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  prop </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-c824d553=""> 1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-c824d553=""> B</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553=""> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#C5E478;" data-v-c824d553=""> A</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  prop</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-c824d553=""> number</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> B</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">()</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-c824d553="">prop</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span></code></pre><p data-v-c824d553=""><code data-v-c824d553="">TypeScript</code> 结果（target: ES2015）：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">use strict</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-c824d553=""> A</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-c824d553="">  constructor</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic;" data-v-c824d553="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-c824d553="">prop</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-c824d553=""> 1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  }</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-c824d553=""> B</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553=""> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#C5E478;" data-v-c824d553=""> A</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">  // 注意这里 B 中的 prop 定义只有类型，整个会被擦除</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> B</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">()</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-c824d553="">prop</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">; </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// 所以这里结果会是 1</span></span></code></pre><p data-v-c824d553=""><code data-v-c824d553="">SWC</code> 结果：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// .swcrc</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">{</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">  "jsc"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">    "parser"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">      "syntax"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#C789D6;" data-v-c824d553="">typescript</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">    "target"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#C789D6;" data-v-c824d553="">es2015</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">    "loose"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-c824d553=""> false</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553=""> // loose 对编译结果也会有影响</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  }</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span></code></pre><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> { </span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553="">_</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553=""> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> r } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">@swc/helpers/_/_define_property</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-c824d553=""> A</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-c824d553="">  constructor</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553="">    r</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic;" data-v-c824d553="">this</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">prop</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-c824d553=""> 1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">);</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  }</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-c824d553=""> B</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553=""> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#C5E478;" data-v-c824d553=""> A</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-c824d553="">  constructor</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553="">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553="">s</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#6F42C1;--shiki-dark:#7FDBCA;" data-v-c824d553="">    super</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553="">s</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">)</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> r</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic;" data-v-c824d553="">this</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">prop</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553=""> void</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-c824d553=""> 0</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">); </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// 💥 这里 B 中会真实定义出 prop 并赋值 undefined</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  }</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> B</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">()</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-c824d553="">prop</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">; </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// 所以这里结果会是 undefined</span></span></code></pre><h3 id="%E4%BE%9D%E8%B5%96%E5%85%A8%E5%B1%80%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9C%BA%E6%99%AF" data-v-c824d553="">依赖全局类型系统的场景<a name="%E4%BE%9D%E8%B5%96%E5%85%A8%E5%B1%80%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9C%BA%E6%99%AF" class="headerlink" href="#%E4%BE%9D%E8%B5%96%E5%85%A8%E5%B1%80%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9C%BA%E6%99%AF" data-v-c824d553=""></a></h3><p data-v-c824d553="">在我遇到的某些项目中，重度依赖了装饰器和装饰器元数据，那么实际上 SWC 就无法处理了，只能依旧保留 ts-loader：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// rspack.config.js</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-c824d553="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-c824d553="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  module</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">    rules</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> [</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">      {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">        loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">builtin:swc-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">        options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">          /* ...swc options */</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">      }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">      {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">        loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">ts-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">        options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">          transpileOnly</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-c824d553=""> true</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">          happyPackMode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-c824d553=""> true</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">      }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">    ]</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">};</span></span></code></pre><p data-v-c824d553="">像这样继续使用 ts-loader，对构建性能的影响就会比较大，最终的提升效果会变小。不过好消息是 <a href="https://github.com/microsoft/typescript-go" target="_blank" class="" data-v-c824d553=""><!--[-->TypeScript 7<!--]--></a> 正如火如荼地进行中，未来可以迁移到 go 版本的 TS 来获得性能提升。</p><p data-v-c824d553="">SWC 无法处理的一个具体场景如下：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// enum.ts</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D6DEEB;" data-v-c824d553=""> TestEnum</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C5E478;" data-v-c824d553="">  a</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">a</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C5E478;" data-v-c824d553="">  b</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">b</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// index.ts</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> { TestEnum } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">./enum</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">const</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> decorator</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-c824d553=""> any</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553=""> ()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553=""> {}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-c824d553=""> TestClass</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#82AAFF;" data-v-c824d553="">  @</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">decorator</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  prop</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-c824d553=""> TestEnum</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span></code></pre><p data-v-c824d553="">ts-loader 的结果：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">var</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553=""> TestClass</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553=""> /** </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">@class</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553=""> */</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">function</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553=""> ()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">  function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> TestClass</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553=""> {}</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553="">  __decorate</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">    // ⚠️ 这里 TypeScrip 直接基于枚举定义推导出是 String</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">    [</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553="">decorator</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-c824d553="">,</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> __metadata</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">design:type</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-c824d553="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553=""> String</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">)]</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-c824d553="">    TestClass</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-c824d553="">prototype</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">    '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">prop</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  )</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553=""> TestClass</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">)();</span></span></code></pre><p data-v-c824d553="">SWC 的结果：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">var</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> TestClass</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> TestClass</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-c824d553="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">  '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">use strict</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553="">  _class_call_check</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic;" data-v-c824d553="">this</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-c824d553="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553=""> TestClass</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-c824d553="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553="">_ts_decorate</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  [</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553="">    decorator</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553="">    _ts_metadata</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">      '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">design:type</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">      // ⚠️ SWC 在这里的运行时结果是 TestEnum 对象本身</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">      typeof</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-c824d553=""> _enum__WEBPACK_IMPORTED_MODULE_0__</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-c824d553="">TestEnum</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> ===</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">undefined</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">        ?</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-c824d553=""> Object</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">        :</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-c824d553=""> _enum__WEBPACK_IMPORTED_MODULE_0__</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-c824d553="">TestEnum</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">    )</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  ]</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-c824d553="">  TestClass</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-c824d553="">prototype</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">  '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">prop</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">  void</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-c824d553=""> 0</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">);</span></span></code></pre><h2 id="worker-loader" data-v-c824d553="">worker-loader<a name="worker-loader" class="headerlink" href="#worker-loader" data-v-c824d553=""></a></h2><p data-v-c824d553="">worker 本身没有什么问题，Rspack 官方也有对 <a href="https://rspack.rs/zh/guide/features/web-workers#worker-loader" target="_blank" class="" data-v-c824d553=""><!--[-->worker-loader<!--]--></a> 处理的说明。但我单独提出这点的原因是，我需要兼容业务方的代码，让业务方做到无感迁移，这在迁移中给我造成了不少的麻烦。</p><p data-v-c824d553="">大部分业务方对 worker 使用内联写法，这样的好处是业务方的上层应用无需关注底层 worker 的实现细节：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// 注意这里的参数，都是 `worker-loader@v2` 的格式</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> Worker</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">worker-loader?inline=true&amp;fallback=false!./worker.js</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">);</span></span></code></pre><p data-v-c824d553="">但这种内联参数导致无法直接使用官方基于 <code data-v-c824d553="">worker-loader@v3</code> 实现的 <a href="https://github.com/rspack-contrib/worker-rspack-loader" target="_blank" class="" data-v-c824d553=""><!--[-->worker-rspack-loader<!--]--></a>。此外，<code data-v-c824d553="">worker-loader@v3</code> 与 <code data-v-c824d553="">v2</code> 在打包行为上也有差异：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// rspack.config.js</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-c824d553="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-c824d553="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  externals</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">    lodash</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">_</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">};</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// work.js</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> lodash </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">lodash</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">;</span></span></code></pre><ul data-v-c824d553=""><li data-v-c824d553=""><code data-v-c824d553="">v2</code>：打包出来的 worker.js，不会遵循 externals，对于上述例子中的 lodash 会打包进 worker.js 中</li><li data-v-c824d553=""><code data-v-c824d553="">v3</code>：打包结果会遵循 externals，worker.js 中不会包含 lodash 的内容，而是直接引用全局变量 <code data-v-c824d553="">_</code>，导致运行时错误</li></ul><p data-v-c824d553="">由于 worker-rspack-loader 的内在限制，我 fork 了 worker-rspack-loader，实现了一个自定义的 custom-worker-rspack-loader，在自定义的 loader 中：</p><ol data-v-c824d553=""><li data-v-c824d553="">我对 loader 的参数加了一层 v2、v3 的兼容，实现针对 v2 参数格式的兼容，位置在 <a href="https://github.com/rspack-contrib/worker-rspack-loader/blob/124098b9c6ca3467cdbdc675ea095fbfb3a11f1c/src/index.js#L19" target="_blank" class="" data-v-c824d553=""><!--[-->src/index.js#L19<!--]--></a></li><li data-v-c824d553="">增加了自定义参数 <code data-v-c824d553="">disableExternals</code>，可以控制禁用默认的 external 行为，让打包行为和 v2 一样不排除依赖，位置在 <a href="https://github.com/rspack-contrib/worker-rspack-loader/blob/124098b9c6ca3467cdbdc675ea095fbfb3a11f1c/src/index.js#L76" target="_blank" class="" data-v-c824d553=""><!--[-->src/index.js#L76<!--]--></a></li></ol><p data-v-c824d553="">最后借助 <code data-v-c824d553="">resolveLoader</code> 实现 loader 替换，实现了业务方无感迁移：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// rspack.config.cjs</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-c824d553="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-c824d553="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-c824d553=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  resolveLoader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">    alias</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">      '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">worker-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-c824d553=""> require</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553="">resolve</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">custom-worker-rspack-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">)</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">};</span></span></code></pre><h2 id="%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E9%97%AE%E9%A2%98" data-v-c824d553="">模块规范问题<a name="%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E9%97%AE%E9%A2%98" class="headerlink" href="#%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E9%97%AE%E9%A2%98" data-v-c824d553=""></a></h2><p data-v-c824d553="">历史原因导致前端环境下的模块使用方式会有很多，迁移到 Rspack 之后，有些不规范的写法会导致错误。</p><p data-v-c824d553="">比如会有这样的混用：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// node_modules/pkg-a/package.json</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">{</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">  "name"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#C789D6;" data-v-c824d553="">pkg-a</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">  "version"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#C789D6;" data-v-c824d553="">1.0.0</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">  "main"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#C789D6;" data-v-c824d553="">index.js</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">  "exports"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> {</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">    "./sub"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#C789D6;" data-v-c824d553="">./sub.js</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">  }</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span></code></pre><p data-v-c824d553=""><code data-v-c824d553="">import pkgA from 'pkg-a'</code> 会出现 <code data-v-c824d553="">Package subpath '.' is not defined by "exports"</code> 的错误，只需在 <code data-v-c824d553="">exports</code> 中补充 <code data-v-c824d553="">".": "./index.js"</code> 即可。</p><p data-v-c824d553="">也有像这样 <code data-v-c824d553="">pkg-b</code>（type: module）中引用 <code data-v-c824d553="">pkg-c</code>（commonjs）导致的错误：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// node_modules/pkg-b/package.json</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">{</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">  "name"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#C789D6;" data-v-c824d553="">pkg-b</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-c824d553="">  "type"</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#C789D6;" data-v-c824d553="">module</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">}</span></span></code></pre><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// node_modules/pkg-b/index.js</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553=""> c </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-c824d553="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">pkg-c/a/b/c</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-c824d553="">; </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-c824d553="">// pkg-c 中没有使用 exports 定义</span></span></code></pre><p data-v-c824d553="">此时会出现 <code data-v-c824d553="">Module not found</code> 的错误：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-c824d553=""><code data-v-c824d553=""><span class="line" data-v-c824d553=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553="">ERROR</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553=""> in</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553=""> ./node_modules/pkg-b/index.js</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553=""> 1:0-27</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-c824d553="">  ×</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553=""> Module</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553=""> not</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553=""> found:</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553=""> Can</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">t resolve </span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553="">pkg-c/a/b/c</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553=""> in </span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553="">...</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">   ╭─[1:0]</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553=""> 1 │ import pa from </span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553="">pkg-c/a/b/c</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">   · ───────────────────────────</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553=""> 2 │ export var a = 1;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553=""> 3 │ export var b = 2;</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">   ╰────</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">  help: Did you mean </span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553="">.../node_modules/pkg-c/a/b/c.js</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">?</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">        The request </span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553="">pkg-c/a/b/c</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553=""> failed to resolve only because it was resolved as fully specified,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">        probably because the origin is strict EcmaScript Module,</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">        e. g. a module with javascript mimetype, a </span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#2B5581;--shiki-dark:#7FDBCA;" data-v-c824d553="">*</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553="">.mjs</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553=""> file, or a </span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#2B5581;--shiki-dark:#7FDBCA;" data-v-c824d553="">*</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553="">.js</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553=""> file where the package.json contains </span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">'"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">type</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-c824d553="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">module</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-c824d553="">"'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">.</span></span>
<span class="line" data-v-c824d553=""></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">        The extension in the request is mandatory for it to be fully specified.</span></span>
<span class="line" data-v-c824d553=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-c824d553="">        Add the extension to the request.</span></span></code></pre><p data-v-c824d553="">解法有多种：</p><ul data-v-c824d553=""><li data-v-c824d553="">删除 <code data-v-c824d553="">pkg-b/package.json</code> 中的 <code data-v-c824d553="">type: module</code>，只使用 <code data-v-c824d553="">module: index.js</code> 即可</li><li data-v-c824d553="">或者显式添加 <code data-v-c824d553="">.js</code> 后缀 <code data-v-c824d553="">import c from 'pkg-c/a/b/c.js'</code>，不建议使用这种方式，对依赖有要求</li></ul><h2 id="%E5%B0%8F%E7%BB%93" data-v-c824d553="">小结<a name="%E5%B0%8F%E7%BB%93" class="headerlink" href="#%E5%B0%8F%E7%BB%93" data-v-c824d553=""></a></h2><p data-v-c824d553="">在踩过这些坑后，之后的项目再从 Webpack 迁移到 Rspack 就变得简单了，敲个迁移命令、检查下打包配置，基本上在分钟级就能完成，对业务而言能以极低的迁移成本换取客观的性能改善。</p><!--]--></div></article><aside class="pointer-events-none fixed z-20 top-0 w-full h-full left-0 overscroll-contain transition-300 lg:pointer-events-auto lg:absolute lg:w-auto lg:bg-transparent lg:left-[calc(100%+clamp(6px,17.1875vw-176px,50px))]" data-v-c824d553=""><nav class="overflow-y-auto text-foreground overscroll-contain bg-background w-74 max-w-4/5 h-full py-8 px-6 rounded-tl-xl rounded-bl-xl absolute top-0 transition-300 right-0 translate-x-full lg:p-0 lg:max-w-44 xl:max-w-50 lg:h-auto lg:max-h-[calc(100vh-130px)] lg:rounded-none lg:sticky lg:top-10 lg:right-auto lg:translate-x-0 lg:bg-transparent lg:ml-0" data-v-c824d553=""><h2 class="mb-2 font-bold lg:hidden" data-v-c824d553="">TABLE OF CONTENTS</h2><ul class="group/root" data-v-c824d553=""><!--[--><li><a href="#Babel%20%E8%BF%81%E7%A7%BB%E5%88%B0%20SWC" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="Babel 迁移到 SWC">Babel 迁移到 SWC</span></a><ul class=""><!--[--><li><a href="#babel-plugin-react-css-modules" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="babel-plugin-react-css-modules">babel-plugin-react-css-modules</span></a><!----></li><li><a href="#babel-plugin-jsx-control-statements" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="babel-plugin-jsx-control-statements">babel-plugin-jsx-control-statements</span></a><!----></li><li><a href="#proposal%20%E7%B3%BB%E5%88%97%E6%8F%92%E4%BB%B6" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="proposal 系列插件">proposal 系列插件</span></a><!----></li><!--]--></ul></li><li><a href="#TypeScript%20%E8%BF%81%E7%A7%BB" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="TypeScript 迁移">TypeScript 迁移</span></a><ul class=""><!--[--><li><a href="#%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%AE%9A%E4%B9%89%E7%9A%84%E5%9C%BA%E6%99%AF" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="类属性定义的场景">类属性定义的场景</span></a><!----></li><li><a href="#%E4%BE%9D%E8%B5%96%E5%85%A8%E5%B1%80%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9C%BA%E6%99%AF" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="依赖全局类型系统的场景">依赖全局类型系统的场景</span></a><!----></li><!--]--></ul></li><li><a href="#worker-loader" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="worker-loader">worker-loader</span></a><!----></li><li><a href="#%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83%E9%97%AE%E9%A2%98" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="模块规范问题">模块规范问题</span></a><!----></li><li><a href="#%E5%B0%8F%E7%BB%93" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="小结">小结</span></a><!----></li><!--]--></ul></nav></aside></div><hr class="border-border mt-10" data-v-c824d553=""><div class="mt-10" data-v-c824d553=""><div data-v-c824d553=""><h2 class="text-xl font-bold mb-5"><a href="#comment" class="text-accent foreground-link">留言板</a></h2><div class="utterances-wrapper"></div></div></div><!--]--></main><footer class="text-center py-6 text-gray-500 dark:text-gray-400 text-sm"><div><span>© 2017-2025 Daief's Blog</span></div></footer><div></div></div><!--]--></div>
<script>window.__INITIAL_STATE__="{\"naiveUiStyles\":\"\"}"</script>
  

</body></html>