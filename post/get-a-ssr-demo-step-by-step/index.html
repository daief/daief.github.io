<!DOCTYPE html><html ssthtmlattrs="" lang="en"><head>
    <title>从零搭建 SSR | Daief's Blog</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--ssr-head-partial-->
    <script>
      if (/MSIE \d|Trident.*rv:/.test(navigator.userAgent)) {
        // redirect IE to Edge
        // This browser is no longer supported
        window.location.href = 'microsoft-edge:' + window.location.href;
        alert('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
        throw new Error('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
      }
    </script>
    <script type="module" crossorigin="" src="/assets/app-DvX1Smg_.js"></script>
    <link rel="stylesheet" crossorigin="" href="/assets/app-lBf8QYnm.css">
  <link rel="modulepreload" crossorigin="" href="/assets/vm__post_get-a-ssr-demo-step-by-step_-BdyPJNaw.js"><link rel="stylesheet" href="/assets/vm__post_get-a-ssr-demo-step-by-step_-VOyS5pkM.css"><link rel="modulepreload" crossorigin="" href="/assets/meta-info-C-tMy3g2.js"><link rel="modulepreload" crossorigin="" href="/assets/toc-DNILfFl5.js"><link rel="stylesheet" href="/assets/toc-m8VwwUnR.css"><meta name="description" content=""><meta property="og:title" content="从零搭建 SSR | Daief's Blog"><meta property="og:description" content=""><meta property="og:image" content="https://avatars.githubusercontent.com/u/19222089?v=4"><meta name="author" content="daief"></head>
  <body ssrbodyattrs="">
    <div class="page-bg-gradient pointer-events-none fixed start-0 top-0 z-[-1] h-screen w-full"></div>
    <div id="app" data-server-rendered="true"><!--[--><div class="flex flex-col min-h-screen transition-colors duration-300"><header data-v-c69b61b1=""><div id="nav-container" class="max-w-app mx-auto text-foreground sm:bg-transparent" data-v-c69b61b1=""><div id="top-nav-wrap" class="relative grid grid-cols-2 auto-rows-auto w-full items-center justify-between p-4 sm:py-6 sm:flex sm:grid-rows-1" data-v-c69b61b1=""><a href="/" class="py-1 text-xl leading-8 font-semibold whitespace-nowrap sm:my-auto sm:text-2xl sm:leading-none" data-v-c69b61b1=""><!--[-->Daief's Blog<!--]--></a><div class="flex-center justify-end space-x-4 sm:hidden" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button><a role="button" class="text-2xl p-1" data-v-c69b61b1=""><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em" data-v-c69b61b1=""><path fill="currentColor" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg></a></div><nav id="nav-menu" class="col-start-1 col-end-3 w-full flex-col items-center static top-full left-0 right-0 z-10 mt-4 sm:mt-0 sm:ms-2 sm:flex-row sm:justify-end sm:space-x-4 sm:py-0 sm:flex hidden" data-v-c69b61b1=""><ul id="menu-items" class="w-full place-content-center gap-2 sm:flex sm:w-auto sm:gap-x-5 sm:gap-y-0" data-v-c69b61b1=""><!--[--><li class="col-span-2" data-v-c69b61b1=""><a href="/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1 nav-active" data-v-c69b61b1=""><!--[-->文章<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/tags/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->标签<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/about/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->关于<!--]--></a></li><!--]--><li class="col-span-1 hidden sm:block" data-v-c69b61b1=""><a class="flex justify-center items-center h-full px-4 py-3 sm:px-2 sm:py-1" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button></a></li></ul></nav></div></div><div class="mx-auto max-w-app px-4" data-v-c69b61b1=""><hr class="border-border" aria-hidden="true" data-v-c69b61b1=""></div></header><main class="flex-grow max-w-app mx-auto px-4 py-8 w-full text-foreground"><!--[--><div class="relative" data-v-8967a261=""><article data-v-8967a261=""><header data-v-8967a261=""><h1 class="text-foreground text-3xl font-bold mb-4" data-v-8967a261=""> 从零搭建 SSR </h1><div class="flex items-center gap-x-3.5 gap-y-0.5 text-foreground opacity-80 flex-wrap" data-v-8967a261=""><!--[--><!--[--><div class="inline-flex items-center gap-x-0.5 whitespace-nowrap"><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M7 11h2v2H7zm14-6v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2M5 7h14V5H5zm14 12V9H5v10zm-4-6v-2h2v2zm-4 0v-2h2v2zm-4 2h2v2H7zm8 2v-2h2v2zm-4 0v-2h2v2z"></path></svg><span>发表于：<time datetime="2019-07-02T17:10:37.000Z">2019/07/02</time></span></div><!--[--><a href="/tags/SSR/1/" class="inline-flex items-center foreground-link"><svg class="iconify-svg block select-none mr-0.5 text-foreground" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="m5.41 21l.71-4h-4l.35-2h4l1.06-6h-4l.35-2h4l.71-4h2l-.71 4h6l.71-4h2l-.71 4h4l-.35 2h-4l-1.06 6h4l-.35 2h-4l-.71 4h-2l.71-4h-6l-.71 4zM9.53 9l-1.06 6h6l1.06-6z"></path></svg>SSR</a><!--]--><!--]--><!--]--></div></header><div class="md-prose max-w-none dark:prose-invert mt-6" data-v-8967a261=""><!--[--><p data-v-8967a261="">在上一季度中接触并使用了 Next.js，实践了一把 SSR。期间遇见了不少问题，详情可见：<a href="/post/use-summary-of-next-js-and-graphql/" class="" data-v-8967a261=""><!--[-->Next.js、GraphQL 使用小结<!--]--></a>。</p><p data-v-8967a261="">实际上是打算先写那篇文章，但这里还是来写这个了，这样能先从零开始认识 SSR。</p><p data-v-8967a261="">先放上 demo 地址：<a href="https://github.com/daief/react-ssr/tree/master/packages/express-ssr-demo" target="_blank" class="" data-v-8967a261=""><!--[-->https://github.com/daief/react-ssr/tree/master/packages/express-ssr-demo<!--]--></a>。</p><a id="more" href="#more" class="block" data-v-8967a261=""></a><h2 id="%E7%AE%80%E4%BB%8B" data-v-8967a261="">简介<a name="%E7%AE%80%E4%BB%8B" class="headerlink" href="#%E7%AE%80%E4%BB%8B" data-v-8967a261=""></a></h2><p data-v-8967a261="">简单列一下三种渲染方式：</p><ul data-v-8967a261=""><li data-v-8967a261="">客户端渲染（CSR - Client-side Rendering）：常见的 SPA 应用，浏览器加载 HTML、JS 文件，接着执行脚本，构建虚拟 DOM（如 Vue、React），最后再将应用挂载到真实节点上。</li><li data-v-8967a261="">后端渲染：服务器收到请求时，预先进行处理，最后生成一份 HTML 返回给浏览器。</li><li data-v-8967a261="">同构（SSR - Server-Side Rendering）：这里将 SSR 认为是同构。同构这个概念存在于 Vue，React 这些新型的前端框架中，同构实际上是客户端渲染和服务器端渲染的一个整合。</li></ul><p data-v-8967a261="">在同构应用中，写一份代码，在服务端和浏览器都会执行。我们知道（以 React 为例），React 应用中会构建出虚拟 DOM 再挂载到页面上；虚拟 DOM 是内存中的 JS 对象，得益于虚拟 DOM，Node 层也能运行 React。SSR 中 Node 层的一大作用：页面请求来临时，现在 Node 层运行 React 生成虚拟 DOM，再导出成字符串，而后注入到 HTML 返回给浏览器，这一步的同时还能够预先请求数据；浏览器接收 HTML、JS 后运行 React 应用，并能够根据服务端返回的 HTML 快速生成一颗浏览器端的树，同时进行相应的事件绑定。下面借用一张图来展现这整个流程：</p><p data-v-8967a261=""><a href="http://blog.poetries.top/2018/11/18/react-ssr/?utm_source=tuicool&amp;utm_medium=referral" target="_blank" class="" data-v-8967a261=""><!--[-->![](https://ae01.alicdn.com/kf/HTB1X2wve.uF3KVjSZK9762VtXXaQ.png)<!--]--></a></p><p data-v-8967a261="">而下文将要实现的就是这样一个使用了 React 的同构应用 demo。</p><h2 id="%E5%AE%9E%E7%8E%B0" data-v-8967a261="">实现<a name="%E5%AE%9E%E7%8E%B0" class="headerlink" href="#%E5%AE%9E%E7%8E%B0" data-v-8967a261=""></a></h2><p data-v-8967a261="">在真正开始之前需要牢记，Node.js 和浏览器虽然都能运行 JS，但其实是要差异的。Node 层没有 DOM，没有 window，不能处理样式，一旦使用都会报错。</p><p data-v-8967a261="">框架选择：</p><ul data-v-8967a261=""><li data-v-8967a261="">express@^4.17.1</li><li data-v-8967a261="">react@^16.8.0</li><li data-v-8967a261="">webpack@^4.35.0</li><li data-v-8967a261="">typescript@^3.5.0</li></ul><p data-v-8967a261="">表面上说是一份代码会在双端执行，但实际上是有两份代码的，不过绝大部分相同。所以，从两份代码的 webpack 配置开始。</p><h3 id="webpack%20%E9%85%8D%E7%BD%AE" data-v-8967a261="">webpack 配置<a name="webpack%20%E9%85%8D%E7%BD%AE" class="headerlink" href="#webpack%20%E9%85%8D%E7%BD%AE" data-v-8967a261=""></a></h3><p data-v-8967a261="">简单抽离了两者的共同配置，做到项目的基本支持，能够处理 less、images、ts。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> merge</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">webpack-merge</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> nodeExternals</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">webpack-node-externals</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">path</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> MiniCssExtractPlugin</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">mini-css-extract-plugin</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> ManifestPlugin</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">webpack-manifest-plugin</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> commonCfg</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  mode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261=""> process</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-8967a261="">env</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">NODE_ENV</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  context</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261=""> process</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">cwd</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">()</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  output</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    filename</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">[name].js</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  resolve</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    extensions</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">.js</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">.json</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">.ts</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">.tsx</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    alias</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">      '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261=""> path</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">resolve</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">__dirname</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./src/</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  module</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    rules</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">      // 处理 less 文件</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">      {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        test</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> /</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-8967a261="">\.</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">less</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">/</span><span style="--shiki-light:#D32F2F;--shiki-dark:#5CA7E4;" data-v-8967a261="">i</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        use</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">          // 本意不想在服务端配置进行拆离的，但不加的时候，服务端 CSS modules 会有问题</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">          // 所以干脆都加上 MiniCssExtractPlugin 了</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">          {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">            loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261=""> MiniCssExtractPlugin</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-8967a261="">loader</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">          }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">          {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">            loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">css-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">            options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">              modules</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">                mode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">global</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">                localIdentName</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">[local]--[hash:base64:5]</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">              }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">            }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">          }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">          {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">            loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">less-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">            options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">              javascriptEnabled</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic;" data-v-8967a261=""> true</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">            }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">          }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">        ]</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">      }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">      // 处理图片静态资源，这里其实可以做个优化，让 Server 只需要解析得到路径即可</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">      {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        test</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> /</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-8967a261="">\.</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">png</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">|</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">jpe</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">?</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">g</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">|</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">gif</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">|</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">webp</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-8967a261="">)(</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-8967a261="">\?</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">*</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">?</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">url-loader/</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">          limit</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261=""> 4096</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">          fallback</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">            loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">file-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">            options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">              name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">static/[name].[hash:8].[ext]</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">            }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">          }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">      }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">      // 解析 ts</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">      {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        test</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> /</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-8967a261="">\.</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">tsx</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">?</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        exclude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> /</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">node_modules</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">ts-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">          happyPackMode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic;" data-v-8967a261=""> true</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">      }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    ]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> MiniCssExtractPlugin</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">()]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span></code></pre><p data-v-8967a261="">然后来看 Server 和 Client 的配置，您会发现也十分简单，主要区分了 entry 和 output。</p><p data-v-8967a261="">注意 Server 端的 target 配置以及 externals。<strong data-v-8967a261="">Server 代码运行于服务器，相应的依赖也都在 node_modules 当中，所以服务端部分只把自己写的部分代码打包在一起。</strong> <code data-v-8967a261="">target</code> 设置为 <code data-v-8967a261="">node</code> 告诉 webpack 这份代码运行于 Node.js，自动排除一些 Node 依赖；<code data-v-8967a261="">externals: [nodeExternals()]</code> 的配置会排除掉所有 node_modules 的依赖。</p><blockquote data-v-8967a261=""><p data-v-8967a261="">注意，如果您使用了类似 yarn workspaces 的功能，那么您需要像我这样配置 webpack-node-externals，因为该插件默认只会在同级寻找 node_modules 的目录，而在 workspaces 的情况下，node_modules 往往在根目录级别。题外话：webpack-node-externals 寻找 node_modules 的原因是预先读取第三方依赖列表，从而作为判断模块引用是否属于依赖，<a href="https://github.com/liady/webpack-node-externals/blob/cfa1c5b33752fb8cb72360167ae89b23816cdefe/index.js#L36" target="_blank" class="" data-v-8967a261=""><!--[-->详情参照源码<!--]--></a>。</p></blockquote><p data-v-8967a261=""><code data-v-8967a261="">output.libraryTarget</code> 设置为 <code data-v-8967a261="">commonjs</code> 是因为服务端的结果是要被调用的，接下来会看到。</p><p data-v-8967a261="">Client 端需要添加一个 ManifestPlugin，来获取 Client 打包的结果，会在下文中使用到。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> serverCfg</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  target</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">node</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  entry</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    index</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./src/server</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  output</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    libraryTarget</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">commonjs</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261=""> path</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">resolve</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">__dirname</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./distServer</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  externals</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">    // 同级寻找</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">    nodeExternals</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">()</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">    // 指定到根目录寻找</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">    nodeExternals</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">({</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">      modulesDir</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261=""> path</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">resolve</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">__dirname</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">../../node_modules</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    })</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  ]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> clientCfg</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  entry</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    index</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./src/client</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  output</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261=""> path</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">resolve</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">__dirname</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./distClient</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> ManifestPlugin</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">()]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-8967a261="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-8967a261="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">merge</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">commonCfg</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> serverCfg</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> merge</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">commonCfg</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> clientCfg</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)];</span></span></code></pre><p data-v-8967a261="">一些其他的类似文章，会把服务端对样式的配置作为内联，这里的内联指 <code data-v-8967a261="">CSS in JS</code>。因为这样一来服务端就不会出现引用样式文件的情况了，不过这不是一直有用的，有一章会专门说明。</p><h3 id="%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E5%92%8C%E7%BB%84%E4%BB%B6" data-v-8967a261="">添加页面路由和组件<a name="%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E5%92%8C%E7%BB%84%E4%BB%B6" class="headerlink" href="#%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E5%92%8C%E7%BB%84%E4%BB%B6" data-v-8967a261=""></a></h3><p data-v-8967a261="">创建 <code data-v-8967a261="">src</code> 目录及各自的入口文件 <code data-v-8967a261="">src/server.tsx</code> 和 <code data-v-8967a261="">src/client.tsx</code>，目录结构大概是这样的。比较简单，相信每个目录、文件的作用可以轻易猜到，不过还是附上注释。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> src</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   ├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> assets</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">          # 存放静态资源</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   │</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   └──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> gift.png</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   ├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> client.tsx</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">      # Client 入口文件</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   ├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> global.less</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">     # 全局的样式</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   ├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> pages</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">           # 存放页面组件</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   │</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   ├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> About.tsx</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   │</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   ├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> Home.tsx</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   │</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   └──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> home.less</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   ├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> routes.tsx</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">      # 路由配置</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   ├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> server.tsx</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">      # Server 入口文件</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   └──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> store</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">           # 简单的 store</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">       └──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> index.ts</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> tsconfig.json</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">       # TS 配置文件</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">└──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> webpack.config.js</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">   # webpack 配置文件</span></span></code></pre><p data-v-8967a261="">在这里告诉需要告知您 Server 端和 Client 端的一大不同。两端的路由是截然不同的，在 Server 端，通过请求的路由找到对应的组件；在浏览器，通过地址栏中的 URL 渲染对应组件。而且，当浏览器请求到页面后，此时的路由会转交给浏览器。另外，两端最大的不同就在这里了，下面来看具体的实现。</p><p data-v-8967a261="">来看 <code data-v-8967a261="">routes.tsx</code>，该文件配置了路由信息，这是相同的，可一笔带过。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// routes.tsx</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/global.less</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> About </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/pages/About</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> Home </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/pages/Home</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261=""> *</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> React </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { Route</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> Switch } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react-router-dom</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> const</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> Routes</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">:</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-8967a261=""> React</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-8967a261="">SFC</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> ()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">    &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Switch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Route</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> exact</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">/</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">"</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> component</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">Home</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261=""> /&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Route</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">/about</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">"</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> component</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">About</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261=""> /&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">    &lt;/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Switch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  )</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span></code></pre><p data-v-8967a261="">先来看熟悉的 Client 入口。使用 BrowserRouter 将路由包裹，并将 React 应用挂载到 div。这里使用了 <code data-v-8967a261="">hydrate</code>，因为在服务端渲染的情况下能提前得到初次渲染的 HTML，而<strong data-v-8967a261="">hydrate 描述的是 ReactDOM 复用 ReactDOMServer 服务端渲染的内容时尽可能保留结构，并补充事件绑定等 Client 特有内容的过程</strong>（参考 <a href="https://zh-hans.reactjs.org/docs/react-dom.html#hydrate" target="_blank" class="" data-v-8967a261=""><!--[-->[1]<!--]--></a> <a href="https://www.zhihu.com/question/66068748" target="_blank" class="" data-v-8967a261=""><!--[-->[2]<!--]--></a>）。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// client.tsx</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { Routes } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/routes</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> React </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> ReactDOM </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react-dom</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { BrowserRouter } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react-router-dom</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> ClientRender</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">    &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">BrowserRouter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Routes</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261=""> /&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">    &lt;/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">BrowserRouter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  );</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">}</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">ReactDOM</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">hydrate</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">ClientRender</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261=""> /&gt;</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261=""> document</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">querySelector</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">#root</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">));</span></span></code></pre><p data-v-8967a261="">Server 端入口，整个文件导出了一个工厂函数，返回的是一个组件。注意这里没有浏览器 API，<a href="https://reacttraining.com/react-router/web/guides/server-rendering" target="_blank" class="" data-v-8967a261=""><!--[-->使用了 StaticRouter<!--]--></a>，通过传入的 URL 来选择对应的组件。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// server.tsx</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { Routes } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/routes</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261=""> *</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> React </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { StaticRouter } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react-router</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> ServerRender</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">req</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> context</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">props</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">StaticRouter</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> location</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">req</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">url</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> context</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">context</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">        &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Routes</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261=""> /&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">StaticRouter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    );</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  };</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">}</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">export</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> ServerRender;</span></span></code></pre><p data-v-8967a261="">页面组件就很常规，这里不再叙述。</p><h3 id="%E6%B7%BB%E5%8A%A0%20express" data-v-8967a261="">添加 express<a name="%E6%B7%BB%E5%8A%A0%20express" class="headerlink" href="#%E6%B7%BB%E5%8A%A0%20express" data-v-8967a261=""></a></h3><p data-v-8967a261="">目前为止，项目还不能完整运行。在这一步之后，添加 express 的使用后，就能查看效果了。添加新的目录 <code data-v-8967a261="">server</code> 以及脚本，目录结构会是这样。</p><blockquote data-v-8967a261=""><p data-v-8967a261="">这里添加 tsconfig.json 的原因：上一级的配置用于编译整个 src/，而在 src/ 您可能用到 import() 语法，此时需要在 tsconfig.json 中配置 <code data-v-8967a261="">module: exnext</code> 来支持；而 server/ 这里只使用原始 tsc 来编译，内层配置 <code data-v-8967a261="">module: commonjs</code> 使 server/ 的运行免去一些麻烦。</p></blockquote><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261="">...</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> server</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   ├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> index.ts</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">        # 只要一个脚本</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">│</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261="">   └──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> tsconfig.json</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">   # 专门用于编译 server 代码的配置</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">├──</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-8967a261=""> src</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261="">...</span></span>
<span class="line" data-v-8967a261=""></span></code></pre><p data-v-8967a261="">进入 Server 端脚本正题，详情见注释。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> express </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">express</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { resolve } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">path</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261=""> *</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> React </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> ReactDOMServer </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react-dom/server</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// 引用 Server 端打包结果</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> serverBuild</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">../distServer</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-8967a261="">default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// 引用 Client manifest</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> manifest</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">../distClient/manifest.json</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> app</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> express</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">();</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// 将 Client 输出目录作为静态资源目录</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">app</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">use</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">express</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">static</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">resolve</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(__dirname</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">../distClient</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)));</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// `/` `/about` 是支持 SSR 的路由</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">app</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">get</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">([</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">/</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">/about</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">]</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> async</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">req</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> res</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> context</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> any</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">  // 已经渲染过的页面，这里不再渲染</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">context</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">url</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">) {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">    res</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">writeHead</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">302</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">      Location</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261=""> context</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">url</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    });</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">    res</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">end</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">();</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  } </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">else</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">    // 这里模拟在 Server 端请求数据的延迟</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    await</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261=""> new</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-8967a261=""> Promise</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">_</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">      setTimeout</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(_</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261=""> 500</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    });</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">    // 这里把数据先传进去了，现在没用，稍后说明</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">    render</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(req</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> res</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> context</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { count</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261=""> 10</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> });</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  }</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">});</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> render</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">req</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> res</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> ctx</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> data</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">  // 通过 renderToString 将组件转换成 HTML 字符串</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> contentHtml</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> ReactDOMServer</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">renderToString</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">    // 在服务端运行 React</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">    React</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">createElement</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">serverBuild</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">req</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> ctx</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> data</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">))</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  );</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">  // 下面的是拼接出一个完整的 HTML 并发送给浏览器</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  const</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> renderLink</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> ()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> string</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    return</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> Object</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">keys</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">manifest</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">      .</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">filter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-8967a261="">key</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> /</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-8967a261="">\.</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">css</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">/</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">test</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">key</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">))</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">      .</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">map</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-8967a261="">key</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-8967a261=""> `</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic;" data-v-8967a261="">&lt;link rel="stylesheet" href="</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">${</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">manifest</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">[</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">key</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">]</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic;" data-v-8967a261="">"&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-8967a261="">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">      .</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">join</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-8967a261="">\n</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  const</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> renderScripts</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> ()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> string</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    return</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> Object</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">keys</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">manifest</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">      .</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">filter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-8967a261="">key</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> /</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-8967a261="">\.</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">js</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">/</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">test</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">key</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">))</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">      .</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">map</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-8967a261="">key</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-8967a261=""> `</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic;" data-v-8967a261="">&lt;script src="</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">${</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">manifest</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">[</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">key</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">]</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic;" data-v-8967a261="">"&gt;&lt;/script&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-8967a261="">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">      .</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">join</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-8967a261="">\n</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">  res</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">send</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-8967a261="">`</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">    &lt;!DOCTYPE html&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">    &lt;html lang="en"&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">    &lt;head&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">      &lt;meta charset="UTF-8"&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">      &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">      &lt;title&gt;Document&lt;/title&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">      ${</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">renderLink</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">}</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">    &lt;/head&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">    &lt;body&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">      &lt;div id="root"&gt;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">contentHtml</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">&lt;/div&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">      &lt;script&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">        window.__INIT_STORE__ = </span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261="">JSON</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">stringify</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(data)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">}</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">      &lt;/script&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">      ${</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">renderScripts</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">}</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">    &lt;/body&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">    &lt;/html&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-8967a261="">  `</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">}</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> PORT</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261=""> 5000</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">app</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">listen</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261="">PORT</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> ()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">  // tslint:disable-next-line: no-console</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">  console</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">log</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-8967a261="">`</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">http://localhost:</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">${</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261="">PORT</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-8967a261="">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">});</span></span></code></pre><p data-v-8967a261="">到这里基本差不多了，打开两个终端，切到 express-ssr-demo 的路径，分别执行 <code data-v-8967a261="">yarn watch:web</code> &amp; <code data-v-8967a261="">yarn dev:s</code>，顺利的话，在 <a href="http://localhost:5000" target="_blank" class="" data-v-8967a261=""><!--[-->http://localhost:5000<!--]--></a> 就能看到效果，修改页面需要手动刷新一下浏览器。</p><p data-v-8967a261="">细心的同学在 Server 端脚本已经看到了模拟请求延迟、数据获取的部分，如果运行了 demo 也能直接看到效果了。接下来就进行这一部分的补充。</p><h3 id="%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93" data-v-8967a261="">数据渲染<a name="%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93" class="headerlink" href="#%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93" data-v-8967a261=""></a></h3><p data-v-8967a261="">Server 端脚本如上述即可，接下来只需添加状态管理、修改入口部分即可。</p><p data-v-8967a261="">添加状态管理，遵循简单的原则，这里直接在 hooks 的基础上模拟了一个状态管理，若使用 redux 等可自行扩展。</p><p data-v-8967a261=""><code data-v-8967a261="">createStore</code>，其实这是个 hook，使用时还请注意。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// src/store/index.ts</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261=""> *</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> React </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> StoreCtx</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> React</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">createContext</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">&lt;{</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> store</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> any</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">;</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> dispatch</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> any</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> }&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic;" data-v-8967a261="">  null</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> const</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> useStore</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> ()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> result</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> React</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">useContext</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">StoreCtx</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">!</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">result</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    throw</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261=""> new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> Error</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">Cannot get a store context</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  return</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> result</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> createStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">initStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> [</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">store</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-8967a261="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> setStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">]</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> React</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">useState</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">&lt;</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261="">any</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">initStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    store</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">    dispatch</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">payload</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> setStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">pre</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> ({ </span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">pre</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-8967a261="">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261=""> ...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">payload }))</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  };</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">}</span></span></code></pre><p data-v-8967a261="">分别修改入口。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// src/server.tsx</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { Routes } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/routes</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { createStore</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> StoreCtx } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/store</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261=""> *</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> React </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { StaticRouter } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react-router</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> ServerRender</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">req</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> context</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> initStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">props</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">    // hook 要在这、函数组件内部调用</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">    const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> createStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">initStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">StoreCtx.Provider</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">value</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">        &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">StaticRouter</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> location</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">req</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">url</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> context</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">context</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">          &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Routes</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261=""> /&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">        &lt;/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">StaticRouter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">StoreCtx.Provider</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    );</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  };</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">}</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">export</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> ServerRender;</span></span></code></pre><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// src/client.tsx</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { Routes } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/routes</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { createStore</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> StoreCtx } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/store</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> React </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> ReactDOM </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react-dom</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { BrowserRouter } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react-router-dom</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// @ts-ignore 这里是浏览器获取初始数据的地方</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> initStore</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261=""> window</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-8967a261="">__INIT_STORE__</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> ClientRender</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> createStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">initStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">    &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">StoreCtx.Provider</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">value</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">BrowserRouter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">        &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Routes</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261=""> /&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">BrowserRouter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">    &lt;/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">StoreCtx.Provider</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  );</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">}</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">ReactDOM</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">hydrate</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">ClientRender</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261=""> /&gt;</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261=""> document</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">querySelector</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">#root</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">));</span></span></code></pre><p data-v-8967a261="">组件内的使用，也十分简单，比如。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// src/pages/Home.tsx</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { useStore } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">@/store</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261=""> *</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> React </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">react</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-8967a261=""> *</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> styles </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./home.less</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> const</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> Home</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">:</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-8967a261=""> React</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-8967a261="">SFC</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">&lt;{}&gt;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> (</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-8967a261="">props</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">  const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> store</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> dispatch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> }</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> useStore</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#CAECE6;" data-v-8967a261="">div</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> className</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">styles</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">home</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Button</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-8967a261=""> onClick</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">{</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> dispatch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">{ count</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261=""> store</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">count</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> +</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261=""> 1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261=""> }</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">        click to add:</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">      &lt;/</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-8967a261="">Button</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">      {</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-8967a261="">store</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">count</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D3423E;" data-v-8967a261="">}</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#CAECE6;" data-v-8967a261="">div</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-8967a261="">&gt;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  )</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">export</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261=""> default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> Home;</span></span></code></pre><h2 id="%E6%A0%B7%E5%BC%8F%E9%97%AE%E9%A2%98" data-v-8967a261="">样式问题<a name="%E6%A0%B7%E5%BC%8F%E9%97%AE%E9%A2%98" class="headerlink" href="#%E6%A0%B7%E5%BC%8F%E9%97%AE%E9%A2%98" data-v-8967a261=""></a></h2><p data-v-8967a261="">Client 端没问题，这里只针对 Server 端。</p><p data-v-8967a261="">上文有提到会把样式文件内联的处理，因为如此一来 Server 端就不会出现引用样式的情况。但是这只对自己项目下的那部分样式。来仔细分析一下 Server 端的打包结果（distServer 是 Server 端打包的输出目录）。</p><ul data-v-8967a261=""><li data-v-8967a261="">distServer/<ul data-v-8967a261=""><li data-v-8967a261="">pages/home</li><li data-v-8967a261="">pages/about</li><li data-v-8967a261="">global.less</li><li data-v-8967a261="">store</li><li data-v-8967a261="">...</li></ul></li><li data-v-8967a261="">依赖部分（node_modules）<ul data-v-8967a261=""><li data-v-8967a261="">react</li><li data-v-8967a261="">react-dom</li><li data-v-8967a261="">...</li></ul></li></ul><p data-v-8967a261="">在 distServer 只会包含 src/ 的部分，因为在 webpack 明确排除了所有依赖。这一部分中的样式无论是内联还是如上文所述的拆离，都能正常使用。</p><ul data-v-8967a261=""><li data-v-8967a261="">样式内联的情况，没有 <code data-v-8967a261="">require less</code> 的情况</li><li data-v-8967a261="">样式拆离后，代码中也没有引用样式（因为这种情况往往在 Client，是需要在 HTML 额外使用 link 引入的）</li></ul><p data-v-8967a261="">这时候添加一些组件库，比如 antd，引入组件和样式。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> { Button } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">antd</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">antd/dist/antd.less</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// 或</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> Button </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">antd/lib/button</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">antd/lib/button/style</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span></code></pre><p data-v-8967a261="">一跑就报错了，无论内联还是拆离，都出现了 <code data-v-8967a261="">require less</code> 的情况。打包结果会是这样的。当 Server 端脚本运行、执行 <code data-v-8967a261="">require('../distServer')</code> 时，就发生了在 Node 层直接引用 less 的情况，接着就直接报错了。</p><ul data-v-8967a261=""><li data-v-8967a261="">distServer/<ul data-v-8967a261=""><li data-v-8967a261="">...</li></ul></li><li data-v-8967a261="">依赖部分（node_modules）<ul data-v-8967a261=""><li data-v-8967a261="">antd/dist/antd.less</li><li data-v-8967a261="">antd/lib/button/style<ul data-v-8967a261=""><li data-v-8967a261="">index.less</li><li data-v-8967a261="">...</li></ul></li><li data-v-8967a261="">...</li></ul></li></ul><p data-v-8967a261="">这时候去搜索解决方案时，会看到有这样的措施。这样的方案很简单，也很有效，这告诉 require 如何去处理样式文件，这里直接返回一个空的对象。这么一来 Node.js 直接引用样式文件也是 OK 的，因为对于 Node 层来讲样式文件的内容并不重要，只是因为 Client 引用了、因为我们运行同一份代码才导致我也引用了，只有不破坏依赖关系即可。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// 只需将如下代码添加到 Node.js 脚本执行的前面</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">typeof</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> require</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> !==</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">undefined</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">) {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261="">  require</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">extensions</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">.css</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">file</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {};</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261="">  require</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">extensions</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">.less</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">file</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {};</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">}</span></span></code></pre><p data-v-8967a261="">细心的同学可能发现了，上面指的样式文件内容不重要，那是因为这样使用的，如果是 <code data-v-8967a261="">CSS modules</code> 会怎么样呢。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// 不关心样式内容的引用</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">antd/dist/antd.less</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">antd/lib/button/style</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// CSS modules 开启</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> styles </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./module.less</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261="">console</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">log</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261="">styles</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-8967a261="">classNameA</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span></code></pre><p data-v-8967a261="">这一点倒是不用担心，观察 <code data-v-8967a261="">distServer/index.js</code> 可以发现，模块已经被替换成了对象（{"home":"home--1AXZn"}）。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">/***/</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> "</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./src/pages/home.less</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">"</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">/*!*****************************!*\</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">  !*** ./src/pages/home.less ***!</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">  \*****************************/</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">/*! no static exports found */</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">/***/</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">function</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">module</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> exports</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> __webpack_require__</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-8967a261="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">eval</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">// extracted by mini-css-extract-plugin</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-8967a261="">\n</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">module.exports = {</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-8967a261="">\"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">home</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-8967a261="">\"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-8967a261="">\"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">home--1AXZn</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-8967a261="">\"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">};</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-8967a261="">\n\n</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">//# sourceURL=webpack:///./src/pages/home.less?</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">"</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">);</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">/***/</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> })</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span></code></pre><p data-v-8967a261=""><code data-v-8967a261="">require.extensions</code> 虽然好用，但我还是遇见了为难的地方，在使用 <code data-v-8967a261="">next export</code>（Next.js 框架的一个命令） 的时候。所幸，这时候遇见了<a href="https://github.com/zeit/next.js/blob/e00a2c5d64def08fc5c18c5262bfb52da7c87093/examples/with-ant-design/next.config.js#L11" target="_blank" class="" data-v-8967a261=""><!--[-->新的方案<!--]--></a>，再加上 <code data-v-8967a261="">require.extensions</code> 已经不再推荐使用，所以 demo 里也替换成了最终方案。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-8967a261=""><code data-v-8967a261=""><span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">// 修改 Server 的 webpack 配置，如下</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> antStyles</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> /</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">antd</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-8967a261="">\/</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">*?</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-8967a261="">\/</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-8967a261="">style</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-8967a261="">*?</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">/</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span>
<span class="line" data-v-8967a261=""></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261=""> serverCfg</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  target</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">node</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  entry</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    index</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./src/server</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  output</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    libraryTarget</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">commonjs</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261=""> path</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">resolve</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">__dirname</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">./distServer</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  externals</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">    // 关键是这里，对应的样式不要排除，要交给后续的 loader 处理</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">    // 因为一旦排除就被放到 node_modules 里去了</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">    nodeExternals</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">({</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">      whitelist</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">antStyles</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">]</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    })</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">    nodeExternals</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">({</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">      modulesDir</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-8967a261=""> path</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-8967a261="">resolve</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">__dirname</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">../../node_modules</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">)</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">      whitelist</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261="">antStyles</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">]</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    })</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">  ]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">  module</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261=""> {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-8967a261="">    rules</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261=""> [</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">      {</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">        // null-loader 的作用是将一个模块静默化，可以看作会把每个作用的模块变成一个空文件再给其他文件去引用</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">        // 这里的 null-loader 其实不必要</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">        // 如果加了，需要注意匹配的范围</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-8967a261="">        // 如果不加只是样式文件会被后面的 loader 处理而已</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        test</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-8967a261=""> antStyles</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        use</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">null-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-8967a261="">        enforce</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-8967a261="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-8967a261="">pre</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-8967a261="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">      }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">    ]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-8967a261="">,</span></span>
<span class="line" data-v-8967a261=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-8967a261="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-8967a261="">;</span></span></code></pre><p data-v-8967a261="">以上，就是我使用以来对样式文件的纠结。</p><h2 id="%E7%BB%93%E8%AF%AD" data-v-8967a261="">结语<a name="%E7%BB%93%E8%AF%AD" class="headerlink" href="#%E7%BB%93%E8%AF%AD" data-v-8967a261=""></a></h2><p data-v-8967a261="">终于到了结束的时候，好久没扯这么长的皮了（字数不够、代码来凑），文中好多“后续、后文再讲”，不知道对读者来说是什么感受，还请见谅。</p><p data-v-8967a261="">现在看来 Server 端的依赖不打包，才扯出来这一套套的（指样式文件）；因为是 Server 端，不打包有它的道理，但如果 Server 端直接打包又如何呢？</p><p data-v-8967a261="">别当真，如果真尝试了请记得把 React 设置为 external。</p><p data-v-8967a261="">在这里十分感谢杰哥给我的耐心讲解，十分感谢点进此文的你！</p><p data-v-8967a261="">谨以此文帮助我们对 SSR 能有更好的理解。</p><p data-v-8967a261="">最后再放一遍 demo 地址：<a href="https://github.com/daief/react-ssr/tree/master/packages/express-ssr-demo" target="_blank" class="" data-v-8967a261=""><!--[-->https://github.com/daief/react-ssr/tree/master/packages/express-ssr-demo<!--]--></a>。</p><p data-v-8967a261="">完。</p><hr data-v-8967a261=""><p data-v-8967a261="">参考链接：</p><ul data-v-8967a261=""><li data-v-8967a261=""><a href="https://juejin.im/post/5bc7ea48e51d450e46289eab" target="_blank" class="" data-v-8967a261=""><!--[-->React 中同构（SSR）原理脉络梳理<!--]--></a></li><li data-v-8967a261=""><a href="http://blog.poetries.top/2018/11/18/react-ssr/?utm_source=tuicool&amp;utm_medium=referral" target="_blank" class="" data-v-8967a261=""><!--[-->从零到一搭建 React SSR 工程架构(一)<!--]--></a></li></ul><!--]--></div></article><aside class="pointer-events-none fixed z-20 top-0 w-full h-full left-0 overscroll-contain transition-300 lg:pointer-events-auto lg:absolute lg:w-auto lg:bg-transparent lg:left-[calc(100%+clamp(6px,17.1875vw-176px,50px))]" data-v-8967a261=""><nav class="overflow-y-auto text-foreground overscroll-contain bg-background w-74 max-w-4/5 h-full py-8 px-6 rounded-tl-xl rounded-bl-xl absolute top-0 transition-300 right-0 translate-x-full lg:p-0 lg:max-w-44 xl:max-w-50 lg:h-auto lg:max-h-[calc(100vh-130px)] lg:rounded-none lg:sticky lg:top-10 lg:right-auto lg:translate-x-0 lg:bg-transparent lg:ml-0" data-v-8967a261=""><h2 class="mb-2 font-bold lg:hidden" data-v-8967a261="">TABLE OF CONTENTS</h2><ul class="group/root" data-v-8967a261=""><!--[--><li><a href="#%E7%AE%80%E4%BB%8B" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="简介">简介</span></a><!----></li><li><a href="#%E5%AE%9E%E7%8E%B0" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="实现">实现</span></a><ul class=""><!--[--><li><a href="#webpack%20%E9%85%8D%E7%BD%AE" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="webpack 配置">webpack 配置</span></a><!----></li><li><a href="#%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E5%92%8C%E7%BB%84%E4%BB%B6" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="添加页面路由和组件">添加页面路由和组件</span></a><!----></li><li><a href="#%E6%B7%BB%E5%8A%A0%20express" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="添加 express">添加 express</span></a><!----></li><li><a href="#%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="数据渲染">数据渲染</span></a><!----></li><!--]--></ul></li><li><a href="#%E6%A0%B7%E5%BC%8F%E9%97%AE%E9%A2%98" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="样式问题">样式问题</span></a><!----></li><li><a href="#%E7%BB%93%E8%AF%AD" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="结语">结语</span></a><!----></li><!--]--></ul></nav></aside></div><hr class="border-border mt-10" data-v-8967a261=""><div class="mt-10" data-v-8967a261=""><div data-v-8967a261=""><h2 class="text-xl font-bold mb-5"><a href="#comment" class="text-accent foreground-link">留言板</a></h2><div class="utterances-wrapper"></div></div></div><!--]--></main><footer class="text-center py-6 text-gray-500 dark:text-gray-400 text-sm"><div><span>© 2017-2025 Daief's Blog</span></div></footer><div></div></div><!--]--></div>
<script>window.__INITIAL_STATE__="{\"naiveUiStyles\":\"\"}"</script>
  

</body></html>