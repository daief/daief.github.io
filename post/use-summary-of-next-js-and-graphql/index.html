<!DOCTYPE html><html ssthtmlattrs="" lang="en"><head>
    <title>Next.js、GraphQL 使用小结 | Daief's Blog</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--ssr-head-partial-->
    <script>
      if (/MSIE \d|Trident.*rv:/.test(navigator.userAgent)) {
        // redirect IE to Edge
        // This browser is no longer supported
        window.location.href = 'microsoft-edge:' + window.location.href;
        alert('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
        throw new Error('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
      }
    </script>
    <script type="module" crossorigin="" src="/assets/app-DvX1Smg_.js"></script>
    <link rel="stylesheet" crossorigin="" href="/assets/app-lBf8QYnm.css">
  <link rel="modulepreload" crossorigin="" href="/assets/vm__post_use-summary-of-next-js-and-graphql_-BNrGdiJr.js"><link rel="stylesheet" href="/assets/vm__post_use-summary-of-next-js-and-graphql_-D_UJcBHJ.css"><link rel="modulepreload" crossorigin="" href="/assets/meta-info-C-tMy3g2.js"><link rel="modulepreload" crossorigin="" href="/assets/toc-DNILfFl5.js"><link rel="stylesheet" href="/assets/toc-m8VwwUnR.css"><meta name="description" content=""><meta property="og:title" content="Next.js、GraphQL 使用小结 | Daief's Blog"><meta property="og:description" content=""><meta property="og:image" content="https://avatars.githubusercontent.com/u/19222089?v=4"><meta name="author" content="daief"></head>
  <body ssrbodyattrs="">
    <div class="page-bg-gradient pointer-events-none fixed start-0 top-0 z-[-1] h-screen w-full"></div>
    <div id="app" data-server-rendered="true"><!--[--><div class="flex flex-col min-h-screen transition-colors duration-300"><header data-v-c69b61b1=""><div id="nav-container" class="max-w-app mx-auto text-foreground sm:bg-transparent" data-v-c69b61b1=""><div id="top-nav-wrap" class="relative grid grid-cols-2 auto-rows-auto w-full items-center justify-between p-4 sm:py-6 sm:flex sm:grid-rows-1" data-v-c69b61b1=""><a href="/" class="py-1 text-xl leading-8 font-semibold whitespace-nowrap sm:my-auto sm:text-2xl sm:leading-none" data-v-c69b61b1=""><!--[-->Daief's Blog<!--]--></a><div class="flex-center justify-end space-x-4 sm:hidden" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button><a role="button" class="text-2xl p-1" data-v-c69b61b1=""><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em" data-v-c69b61b1=""><path fill="currentColor" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg></a></div><nav id="nav-menu" class="col-start-1 col-end-3 w-full flex-col items-center static top-full left-0 right-0 z-10 mt-4 sm:mt-0 sm:ms-2 sm:flex-row sm:justify-end sm:space-x-4 sm:py-0 sm:flex hidden" data-v-c69b61b1=""><ul id="menu-items" class="w-full place-content-center gap-2 sm:flex sm:w-auto sm:gap-x-5 sm:gap-y-0" data-v-c69b61b1=""><!--[--><li class="col-span-2" data-v-c69b61b1=""><a href="/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1 nav-active" data-v-c69b61b1=""><!--[-->文章<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/tags/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->标签<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/about/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->关于<!--]--></a></li><!--]--><li class="col-span-1 hidden sm:block" data-v-c69b61b1=""><a class="flex justify-center items-center h-full px-4 py-3 sm:px-2 sm:py-1" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button></a></li></ul></nav></div></div><div class="mx-auto max-w-app px-4" data-v-c69b61b1=""><hr class="border-border" aria-hidden="true" data-v-c69b61b1=""></div></header><main class="flex-grow max-w-app mx-auto px-4 py-8 w-full text-foreground"><!--[--><div class="relative" data-v-536f64e7=""><article data-v-536f64e7=""><header data-v-536f64e7=""><h1 class="text-foreground text-3xl font-bold mb-4" data-v-536f64e7=""> Next.js、GraphQL 使用小结 </h1><div class="flex items-center gap-x-3.5 gap-y-0.5 text-foreground opacity-80 flex-wrap" data-v-536f64e7=""><!--[--><!--[--><div class="inline-flex items-center gap-x-0.5 whitespace-nowrap"><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M7 11h2v2H7zm14-6v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2M5 7h14V5H5zm14 12V9H5v10zm-4-6v-2h2v2zm-4 0v-2h2v2zm-4 2h2v2H7zm8 2v-2h2v2zm-4 0v-2h2v2z"></path></svg><span>发表于：<time datetime="2019-07-03T19:11:51.000Z">2019/07/03</time></span></div><!--[--><a href="/tags/SSR/1/" class="inline-flex items-center foreground-link"><svg class="iconify-svg block select-none mr-0.5 text-foreground" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="m5.41 21l.71-4h-4l.35-2h4l1.06-6h-4l.35-2h4l.71-4h2l-.71 4h6l.71-4h2l-.71 4h4l-.35 2h-4l-1.06 6h4l-.35 2h-4l-.71 4h-2l.71-4h-6l-.71 4zM9.53 9l-1.06 6h6l1.06-6z"></path></svg>SSR</a><a href="/tags/GraphQL/1/" class="inline-flex items-center foreground-link"><svg class="iconify-svg block select-none mr-0.5 text-foreground" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="m5.41 21l.71-4h-4l.35-2h4l1.06-6h-4l.35-2h4l.71-4h2l-.71 4h6l.71-4h2l-.71 4h4l-.35 2h-4l-1.06 6h4l-.35 2h-4l-.71 4h-2l.71-4h-6l-.71 4zM9.53 9l-1.06 6h6l1.06-6z"></path></svg>GraphQL</a><!--]--><!--]--><!--]--></div></header><div class="md-prose max-w-none dark:prose-invert mt-6" data-v-536f64e7=""><!--[--><p data-v-536f64e7="">近段时间里使用 <a href="https://github.com/zeit/next.js" target="_blank" class="" data-v-536f64e7=""><!--[-->Next.js<!--]--></a> 搭建了两个后台，同时还使用了 GraphQL。期间匆匆忙忙，而且项目都是另一个前端老哥搭建的。所以，自己又抽空从头开始搭建了几个 demo，回顾一下知识，同时整理了一下当时遇见的问题、梳理下其中缘由。</p><p data-v-536f64e7="">本文主要内容包括三个 demo 的介绍，并记录一些在开发过程中遇到的问题和解决，本文对应 Next.js 版本为 <del data-v-536f64e7="">v8.0.3</del>。写的时候发现 Next.js 升级到 v9.0.0 了，自带 TypeScript 支持了，果断把 demo 的版本也升级了。</p><p data-v-536f64e7="">上一篇文章（<a href="/post/get-a-ssr-demo-step-by-step/" class="" data-v-536f64e7=""><!--[-->从零搭建 SSR<!--]--></a>）介绍了从零搭建 SSR 的过程，并且附带了一些问题的讲解，推荐结合阅读。</p><p data-v-536f64e7="">那么，按照惯例就先呈上 demo 地址：<a href="https://github.com/daief/react-ssr" target="_blank" class="" data-v-536f64e7=""><!--[-->react-ssr<!--]--></a>。</p><a id="more" href="#more" class="block" data-v-536f64e7=""></a><h2 id="%E7%AE%80%E4%BB%8B" data-v-536f64e7="">简介<a name="%E7%AE%80%E4%BB%8B" class="headerlink" href="#%E7%AE%80%E4%BB%8B" data-v-536f64e7=""></a></h2><p data-v-536f64e7="">本节对三个 demo 作个简单介绍。</p><p data-v-536f64e7="">正常运行该项目需要配置本地 hosts。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7=""># hosts</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7=""># 模拟 gql-server 的域名</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">127.0.0.1</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-536f64e7="">			gql-server.example.com</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7=""># 模拟应用 account 的域名（nextjs-ssr 或 nextjs-static）</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">127.0.0.1</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-536f64e7="">			account.example.com</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7=""># 模拟应用 customer 的域名（nextjs-ssr 或 nextjs-static）</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">127.0.0.1</span><span style="--shiki-light:#2B5581;--shiki-dark:#ECC48D;" data-v-536f64e7="">			customer.example.com</span></span></code></pre><p data-v-536f64e7="">或者在 <code data-v-536f64e7="">packages/shared/CONFIG.ts</code> 文件中修改成其他域名配置，然后通过域名 + 端口的形式访问本地开发环境。</p><h3 id="nextjs-ssr" data-v-536f64e7="">nextjs-ssr<a name="nextjs-ssr" class="headerlink" href="#nextjs-ssr" data-v-536f64e7=""></a></h3><blockquote data-v-536f64e7=""><p data-v-536f64e7="">地址：<a href="https://github.com/daief/react-ssr/tree/master/packages/nextjs-ssr" target="_blank" class="" data-v-536f64e7=""><!--[-->https://github.com/daief/react-ssr/tree/master/packages/nextjs-ssr<!--]--></a></p></blockquote><p data-v-536f64e7="">这第一个 demo 对应业务开发中的第一个后台，该后台是一个对内的、管理各种应用的后台，其中一个功能需要实现各个应用间的<a href="https://en.wikipedia.org/wiki/Single_sign-on" target="_blank" class="" data-v-536f64e7=""><!--[-->单点登录（SSO）<!--]--></a>。</p><p data-v-536f64e7="">Java 端基于 <a href="https://en.wikipedia.org/wiki/JSON_Web_Token" target="_blank" class="" data-v-536f64e7=""><!--[-->JWT（Json web token）<!--]--></a> 实现授权认证，前端应用在请求时需要把 token 加到请求头当中，同时也会将 token 缓存于 localStorage。</p><p data-v-536f64e7="">这里的每个应用都有一个不同的二级域名（如 a.example.com、b.example.com），而 localStorage 由于跨域限制，前端应用之间不能共享 token，在这种情况打开新的应用时就会需要重新登录。</p><p data-v-536f64e7="">因此，新的方案是把 token 存储在 cookie 里，并设置 Domain 为根域名（.example.com）。如此一来各个应用之间直接就共享 token，而且每个应用不再需要维护 token。</p><p data-v-536f64e7="">因为这是一个对内的应用，同时出于对技术的追求，该项目决定试用 SSR，选型 Next.js。同时前端组表示可以用中间层来做 cookie 的维护，而 Java 端一切保持不变。加上了 Node 层之后，又顺理成章地加上了 GraphQL Server。</p><h3 id="gql-server" data-v-536f64e7="">gql-server<a name="gql-server" class="headerlink" href="#gql-server" data-v-536f64e7=""></a></h3><blockquote data-v-536f64e7=""><p data-v-536f64e7="">地址：<a href="https://github.com/daief/react-ssr/tree/master/packages/gql-server" target="_blank" class="" data-v-536f64e7=""><!--[-->https://github.com/daief/react-ssr/tree/master/packages/gql-server<!--]--></a></p></blockquote><p data-v-536f64e7="">这是一个独立的中间层，主要作用是提供 GraphQL 服务、cookie 管理。</p><p data-v-536f64e7="">其实上面选择用 Next.js 做 SSR 的时候就已经添加了一个 Node 服务，但这里还是另外再起了一个服务，依我的想法出于两个原因：Next.js 服务专门负责 SSR，这边专门提供 GraphQL 服务，职责会比较清晰；两者同一个服务时，Next.js 会作为一个中间来件运作，开发调试时若修改服务端部分代码调试工具会自动重启服务，这就会导致 next 部分也重启了、而且得重新编译，很费时间。</p><p data-v-536f64e7="">该项目基于 <a href="https://www.apollographql.com/docs/" target="_blank" class="" data-v-536f64e7=""><!--[-->Apollo GraphQL<!--]--></a> 系列搭建。</p><p data-v-536f64e7="">nextjs-ssr + gql-server + Java 的整体运作情况如下。</p><p data-v-536f64e7=""><img alt="sequence-chart.jpg" loading="lazy" title="sequence-chart.jpg" class="post-image" src="/assets/sequence-chart-BSMlgd60.jpg" onerror="this.onerror=null;this.src='/images/image-error.jpg';" data-v-536f64e7=""></p><h3 id="nextjs-static" data-v-536f64e7="">nextjs-static<a name="nextjs-static" class="headerlink" href="#nextjs-static" data-v-536f64e7=""></a></h3><blockquote data-v-536f64e7=""><p data-v-536f64e7="">地址：<a href="https://github.com/daief/react-ssr/tree/master/packages/nextjs-static" target="_blank" class="" data-v-536f64e7=""><!--[-->https://github.com/daief/react-ssr/tree/master/packages/nextjs-static<!--]--></a></p></blockquote><p data-v-536f64e7="">该 demo 也使用 Next.js 框架，但依赖的是 Prerender 的功能，最终是静态部署，所以项目中踢除、避免 Server 端的代码。（该 demo 对应第二个后台，只是个常规的管理后台）</p><p data-v-536f64e7="">请求部分依旧使用了 GraphQL，不过该项目没有对应的 GraphQL 服务，API 是 REST 形式的。</p><p data-v-536f64e7="">通过 <a href="https://www.apollographql.com/docs/link/" target="_blank" class="" data-v-536f64e7=""><!--[-->apollo-link<!--]--></a>（可看作是 apollo-client 的中间件）使得 GraphQL 变得十分灵活、不仅仅是依赖于 GraphQL 服务而使用。</p><blockquote data-v-536f64e7=""><p data-v-536f64e7="">apollo-client 是用于发起 GraphQL 请求的一种客户端框架。</p></blockquote><p data-v-536f64e7="">这里的主角是 <a href="https://www.apollographql.com/docs/link/links/rest/" target="_blank" class="" data-v-536f64e7=""><!--[-->apollo-link-rest<!--]--></a>，让我们很轻易地通过 GraphQL 调用 REST API。</p><p data-v-536f64e7="">这样可以在前端实现接口聚合、字段查询（基于真实接口的返回）等 GraphQL 的特色功能。</p><h2 id="Next.js%20%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98" data-v-536f64e7="">Next.js 使用问题<a name="Next.js%20%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98" class="headerlink" href="#Next.js%20%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98" data-v-536f64e7=""></a></h2><p data-v-536f64e7="">下面把和 Next.js 有关的问题聚合在这一节。</p><h3 id="%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%84%E7%90%86" data-v-536f64e7="">样式文件的处理<a name="%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%84%E7%90%86" class="headerlink" href="#%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%84%E7%90%86" data-v-536f64e7=""></a></h3><p data-v-536f64e7="">这个应该是使用 SSR 时候的经典问题了，不过有关样式文件在 SSR 中的问题在<a href="/post/get-a-ssr-demo-step-by-step/" class="" data-v-536f64e7=""><!--[-->从零搭建 SSR<!--]--></a>有详细解读，这里只说明该问题在 Next.js 中的具体解决以及和 Next.js 有关的注意点。</p><p data-v-536f64e7="">这个问题主要可概括为两点：一是缺少 webpack 对于 CSS、Less 的配置；二是 SSR 项目运行的特点。</p><p data-v-536f64e7="">添加相应的 webpack 配置，可使用官方的配置扩展插件：<a href="https://github.com/zeit/next-plugins/tree/master/packages/next-css" target="_blank" class="" data-v-536f64e7=""><!--[-->@zeit/next-css<!--]--></a>、<a href="https://github.com/zeit/next-plugins/tree/master/packages/next-less" target="_blank" class="" data-v-536f64e7=""><!--[-->@zeit/next-less<!--]--></a>，然后在 <code data-v-536f64e7="">next.config.js</code> 中使用：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// next.config.js</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> withCSS</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">@zeit/next-css</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">);</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> withCSS</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">  withLess</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">({</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">    /* config options here */</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    cssModules</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7=""> /* 开启 cssModules */</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-536f64e7=""> true</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    lessLoaderOptions</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      javascriptEnabled</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-536f64e7=""> true</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    cssLoaderOptions</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      importLoaders</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-536f64e7=""> 1</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      localIdentName</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">[local]_[hash:base64:5]</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  })</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">);</span></span></code></pre><p data-v-536f64e7="">如此一来，项目中就能正常引用样式文件了。</p><blockquote data-v-536f64e7=""><p data-v-536f64e7="">坑点：引入第三方组件库如 antd 时样式依旧会报错。</p></blockquote><p data-v-536f64e7="">最为简单的方式，在 <code data-v-536f64e7="">next.config.js</code> 顶部添加：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// next.config.js</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">typeof</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> require</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> !==</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">undefined</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">) {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">  require</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">extensions</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">.css</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">file</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {};</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">  require</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">extensions</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">.less</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">file</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {};</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">}</span></span></code></pre><blockquote data-v-536f64e7=""><p data-v-536f64e7="">坑点：所有的样式文件都开启了 CSS modules；打包时样式依旧报错。</p></blockquote><p data-v-536f64e7="">尝试自定义 webpack 的样式配置，简单粗暴之处在于所有（Server &amp; Client）样式都过一遍 loader。在这样的配置下，只要在需要开启 CSS modules 的地方添加 <code data-v-536f64e7="">:local()</code> 即可。（以下配置基于 css-loader@^3，顺便一提官方插件所用的是 css-loader@1，两者配置之间会有差异）</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// withStyle.js</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> MiniCssExtractPlugin</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">mini-css-extract-plugin</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">);</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> OptimizeCSSAssetsPlugin</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">optimize-css-assets-webpack-plugin</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">);</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">nextConfig</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">  return</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7=""> Object</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">assign</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">({}</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> nextConfig</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">    webpack</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">config</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> options</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-536f64e7="">      const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> {</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> dev</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-536f64e7="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> isServer</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> }</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> options</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-536f64e7="">      const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">        cssLoaderOptions</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">        postcssLoaderOptions</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">        lessLoaderOptions</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> {}</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7="">      }</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> nextConfig</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">      options</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">defaultLoaders</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">css</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7=""> MiniCssExtractPlugin</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">loader</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">css-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">            sourceMap</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> dev</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">            modules</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">              mode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">global</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">              localIdentName</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">[local]--[hash:base64:5]</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">            }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">            ...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">cssLoaderOptions</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      ];</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">      options</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">defaultLoaders</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">less</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">        ...</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">options</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">defaultLoaders</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">css</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">less-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">            javascriptEnabled</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-536f64e7=""> true</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">            ...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">lessLoaderOptions</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      ];</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">      config</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">module</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">rules</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">push</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          test</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> /</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\.</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">css</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          use</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7=""> options</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">defaultLoaders</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">css</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          test</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> /</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\.</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">less</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          use</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7=""> options</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">defaultLoaders</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">less</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      );</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">      config</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">plugins</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">push</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">        new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> MiniCssExtractPlugin</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">({</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">          // 要加上 static，否则打包后 404</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          filename</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> dev</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">            ?</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">static/css/[name].css</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">            :</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">static/css/[name].[contenthash:8].css</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          chunkFilename</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> dev</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">            ?</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">static/css/[name].chunk.css</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">            :</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">static/css/[name].[contenthash:8].chunk.css</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        })</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">        new</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> (</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">webpack-filter-warnings-plugin</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">))({</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          exclude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> /</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">mini-css-extract-plugin</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">^</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">]</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">*</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">Conflicting order between:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        })</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      );</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">      if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">!</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">dev</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> &amp;&amp;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> !</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">isServer</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">) {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">        // 构建模式 &amp; Client 才开启压缩</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">        config</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">optimization</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">minimizer</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">          ...</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">config</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">optimization</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">minimizer</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">          new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> OptimizeCSSAssetsPlugin</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">({})</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        ];</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      }</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">      // ......</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  });</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">};</span></span></code></pre><p data-v-536f64e7="">最后再修改 externals 配置，放开 antd 的样式就能支持了。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// next.config.js</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// 这种配置下就不需要在顶部添加对 require 的处理了</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> withStyle</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">@react-ssr/shared/next-config/withStyle</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">);</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> withStyle</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">({</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">  webpack</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">config</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> options</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">isServer</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">) {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">      // https://github.com/zeit/next.js/blob/canary/examples/with-ant-design/next.config.js</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">      // 如果有其他 UI 库的样式，在此补充</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-536f64e7="">      const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> antStyles</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> /</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-536f64e7="">antd</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-536f64e7="">\/</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">*?</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-536f64e7="">\/</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic;" data-v-536f64e7="">style</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">*?</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-536f64e7="">      const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> origExternals</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">...</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">config</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-536f64e7="">externals</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">];</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">      config</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">externals</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">        (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">context</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> request</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> callback</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">          if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> (</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">request</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">match</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">antStyles</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">)) </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">return</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> callback</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">();</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">          if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">typeof</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> origExternals</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">[</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-536f64e7="">0</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">===</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">function</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">) {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">            origExternals</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">[</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-536f64e7="">0</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">](</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">context</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> request</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> callback</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">);</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          } </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">else</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">            callback</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">();</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">          }</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">        ...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">typeof</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> origExternals</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">[</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-536f64e7="">0</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">===</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">function</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> ?</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> origExternals</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">)</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      ];</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    }</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7=""> config</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">});</span></span></code></pre><blockquote data-v-536f64e7=""><p data-v-536f64e7="">坑点：打包后，前端路由切换页面时样式丢失。</p></blockquote><p data-v-536f64e7="">这是因为样式在打包后，根据页面被拆分开来。而当第一打开页面时，SSR 渲染的 HTML 文档中只包含当前页面的 CSS 链接，此时在前端切换页面时也不会去加载缺失的样式文件。目前为止的解决方式是将所有的样式打包在一起，添加对应的如下配置。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// withStyle.js</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// ...</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> ()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> ({</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">  webpack</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">    // 把所有 css 合并，因为前端路由切换页面的时候不会拉取对应的 css 文件</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">    // 服务端配置走不走不影响</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">    config</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">optimization</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">splitChunks</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">cacheGroups</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">styles</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">styles</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      test</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> /</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\.</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">(css</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">less)</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      chunks</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">all</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      enforce</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-536f64e7=""> true</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    };</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">    // ...</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">});</span></span></code></pre><h3 id="%E5%9B%BE%E7%89%87%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86" data-v-536f64e7="">图片等静态文件处理<a name="%E5%9B%BE%E7%89%87%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86" class="headerlink" href="#%E5%9B%BE%E7%89%87%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86" data-v-536f64e7=""></a></h3><p data-v-536f64e7="">Next.js 对 <a href="https://github.com/zeit/next.js#static-file-serving-eg-images" target="_blank" class="" data-v-536f64e7=""><!--[-->`static/` 目录有特殊的支持<!--]--></a>，推荐将静态资源放在这个目录，通过 <code data-v-536f64e7="">/static/some/target.png</code> 的形式进行引用。而且在 v9.0.0 版本在打包时还会自动对 <code data-v-536f64e7="">static/</code> 目录内的文件进行压缩。</p><p data-v-536f64e7="">但还是存在 <code data-v-536f64e7="">import img from './a.png'</code> 的需求，这时同样进行 webpack 的配置作为支持即可。注意，如下配置 file-loader 实际上对图片处理了两遍，只是输出路径一致最终只有一份。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// next.config.js</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">config</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">module</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">rules</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">push</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">({</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  test</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> /</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\.</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">(jpe</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">?</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">g</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">png</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">svg</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">gif</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">ico</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">webp)</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  use</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">url-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      options</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        limit</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-536f64e7=""> 8192</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        fallback</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">file-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        publicPath</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> `</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">/_next/static/images/</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-536f64e7="">`</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        outputPath</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> `</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-536f64e7="">${</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">isServer</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> ?</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">../</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-536f64e7="">'</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> :</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> ''</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D3423E;" data-v-536f64e7="">}</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">static/images/</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-536f64e7="">`</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">        name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">[name]-[hash].[ext]</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  ]</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">});</span></span></code></pre><h3 id="Monorepo%20%E4%B8%AD%E7%9A%84%20Babel%20%E9%85%8D%E7%BD%AE" data-v-536f64e7="">Monorepo 中的 Babel 配置<a name="Monorepo%20%E4%B8%AD%E7%9A%84%20Babel%20%E9%85%8D%E7%BD%AE" class="headerlink" href="#Monorepo%20%E4%B8%AD%E7%9A%84%20Babel%20%E9%85%8D%E7%BD%AE" data-v-536f64e7=""></a></h3><p data-v-536f64e7="">当项目以 <a href="https://en.wikipedia.org/wiki/Monorepo" target="_blank" class="" data-v-536f64e7=""><!--[-->Monorepo<!--]--></a> 方式组织，同时引用其他子包内容时，引用的部分是不会经过 Babel 处理的。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// Next.js 中 webpack 的 Babel 配置</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// https://github.com/zeit/next.js/blob/aac4e21d46f300d8433b0bd94a7a0f51e443b7d4/packages/next/build/webpack-config.ts#L394</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">[</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">  // ...</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    test</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> /</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\.</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">(tsx</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">ts</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">js</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">mjs</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">jsx)</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">$</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    include</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">      dir</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">      /</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">next-server</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">dist</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">lib</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">      /</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">next</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">dist</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">client</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">      /</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">next</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">dist</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">pages</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">      /</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">(strip-ansi</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">ansi-regex)</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    ]</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">    exclude</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7=""> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">      if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> (</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">        /</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">next-server</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">dist</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">lib</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">test</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">path</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">||</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">        /</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">next</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">dist</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">client</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">test</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">path</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">||</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">        /</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">next</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">dist</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">pages</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">test</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">path</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">||</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">        /</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">(strip-ansi</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">|</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">ansi-regex)</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">[</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-536f64e7="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#82AAFF;" data-v-536f64e7="">/]</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">test</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">path</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">)</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      ) {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">        return</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-536f64e7=""> false</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      }</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">      return</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> /</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-536f64e7="">node_modules</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">/</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">test</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">path</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">);</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    use</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7=""> defaultLoaders</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">babel</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">  // ...</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">];</span></span></code></pre><p data-v-536f64e7="">插件 <a href="https://www.npmjs.com/package/next-transpile-modules" target="_blank" class="" data-v-536f64e7=""><!--[-->next-transpile-modules<!--]--></a> 可以很方便地解决这个问题。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// next.config.js</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// https://github.com/zeit/next.js/blob/aac4e21d46f300d8433b0bd94a7a0f51e443b7d4/examples/with-yarn-workspaces/packages/web-app/next.config.js#L1</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> withTM</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">next-transpile-modules</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">);</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> withTM</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">({</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">  // `@react-ssr/shared` 是 Monorepo 结构下的其他模块的包名</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  transpileModules</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">@react-ssr/shared</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">]</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">});</span></span></code></pre><blockquote data-v-536f64e7=""><p data-v-536f64e7="">坑点：虽然经过如上改造，Babel 会对其他子包进行编译，但是发现 Next.js 项目模块下的 Babel 插件配置（.babelrc）对子包范围内的代码并不生效。</p></blockquote><p data-v-536f64e7="">其实这一点来源 Babel 7 对于配置的变化，Babel 7 新增了根（root）的概念，默认是当前工作目录，也就是 Next.js 项目模块的级别（packages/nextjs-ssr/），此时 Babel 缺少、也不会去读取他子包的插件配置。</p><p data-v-536f64e7="">Babel 推荐在所有 Monorepo 项目的根目录添加 <code data-v-536f64e7="">babel.config.js</code>，以此建立了 Babel 的核心概念。但这对于上述问题的解决还不够，在这里我通过设置 <code data-v-536f64e7="">rootMode: upward</code> 告诉 Babel 向上级寻找，Babel 会自动寻找 <code data-v-536f64e7="">babel.config.js</code> 并将其设置为 root 的值（<a href="https://babeljs.io/docs/en/config-files#project-wide-configuration" target="_blank" class="" data-v-536f64e7=""><!--[-->更多详细内容可查看官方文章 —— Config Files<!--]--></a>）。</p><p data-v-536f64e7="">具体配置如下。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// next.config.js</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">module</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7="">exports</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">  webpack</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">config</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">    config</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">module</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">rules</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">forEach</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">rule</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">      // 这里的改动比较暴力，因为 Next.js 没有直接暴露更改内建 loader 参数的地方</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">      if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> (</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">rule</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">use</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> &amp;&amp;</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7=""> rule</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">use</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">loader</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> ===</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">next-babel-loader</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">) {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">        // 设置 babel 向上寻找 babel.config.js，然后将其所在的路径作为根（root）</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">        // 否则编译其他 package 时不会加载 babel 插件</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">        // https://babeljs.io/docs/en/config-files#project-wide-configuration</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-536f64e7="">        rule</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">use</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">options</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-536f64e7="">rootMode</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-536f64e7="">upward</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-536f64e7="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">      }</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">    });</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">    // ...</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">};</span></span></code></pre><p data-v-536f64e7="">如此一来，再将 Babel 插件配置在 <code data-v-536f64e7="">babel.config.js</code>，那么 Babel 插件在其他模块也会起作用了。</p><h3 id="%E5%9B%BD%E9%99%85%E5%8C%96%E8%AF%AD%E8%A8%80%E6%B8%B2%E6%9F%93%E9%97%AE%E9%A2%98" data-v-536f64e7="">国际化语言渲染问题<a name="%E5%9B%BD%E9%99%85%E5%8C%96%E8%AF%AD%E8%A8%80%E6%B8%B2%E6%9F%93%E9%97%AE%E9%A2%98" class="headerlink" href="#%E5%9B%BD%E9%99%85%E5%8C%96%E8%AF%AD%E8%A8%80%E6%B8%B2%E6%9F%93%E9%97%AE%E9%A2%98" data-v-536f64e7=""></a></h3><p data-v-536f64e7="">在 <code data-v-536f64e7="">nextjs-ssr</code> 中，项目以 SSR 方式运行，在页面请求来临的同时，读取 cookies 就能知晓当前浏览器的语言设置信息，接着就能渲染出对应语言的页面并返回。</p><p data-v-536f64e7="">对于用户来说，当选择英文，首屏返回的页面就英文；选择了中文，返回的就是中文页面。</p><p data-v-536f64e7="">而对于静态部署的 <code data-v-536f64e7="">nextjs-static</code>，并没有动态渲染的能力，页面只有在返回到浏览后才能从 cookies 中读取到语言设置信息，进而将页面切换成对应的语言。</p><p data-v-536f64e7="">页面总有个初始语言，可是这样一来打开页面会有个语言切换的现象（默认语言与实际语言不符），但这个也不好避免。所以，<code data-v-536f64e7="">nextjs-static</code> 中的操作是一概将 Server 的国际化输出设置成 <code data-v-536f64e7="">...</code>，待脚本加载后会自动读取并切换成对应的语言。</p><h2 id="%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98" data-v-536f64e7="">其他问题<a name="%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98" class="headerlink" href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98" data-v-536f64e7=""></a></h2><h3 id="SSR%20%E9%83%A8%E7%BD%B2%E6%9C%9F%E9%97%B4%E7%9A%84%E9%97%AE%E9%A2%98" data-v-536f64e7="">SSR 部署期间的问题<a name="SSR%20%E9%83%A8%E7%BD%B2%E6%9C%9F%E9%97%B4%E7%9A%84%E9%97%AE%E9%A2%98" class="headerlink" href="#SSR%20%E9%83%A8%E7%BD%B2%E6%9C%9F%E9%97%B4%E7%9A%84%E9%97%AE%E9%A2%98" data-v-536f64e7=""></a></h3><p data-v-536f64e7="">在部署期间发生了一个由 <code data-v-536f64e7="">host</code> 字段引发的问题，导致 SSR 层的请求发生错误。</p><p data-v-536f64e7="">结合开头的时序图可以看到，发起 GraphQL 请求的角色有浏览器和 SSR 层，而 SSR 层发起请求时都来源于一个页面的访问。比如，访问主页 <code data-v-536f64e7="">/</code>（不是通过其他前端路由跳转来的），而且主页组件在 <code data-v-536f64e7="">getInitialProps</code> 生命周期中有请求，那么该请求会在 SSR 层发起。同样，这个请求需要携带 token、language 标识等信息，这些信息来源于页面请求的 Header，这步操作见代码。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">// `packages/shared/src/layouts/ApolloWrap/index.tsx`</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> authLink</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> setContext</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-536f64e7="">_</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> {</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-536f64e7=""> headers</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> }</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">  // 这里用于添加自定义的 headers 字段</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">  const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7=""> reqHeaders</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-536f64e7=""> any</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-536f64e7=""> process</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-536f64e7="">browser</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">    ?</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> {}</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">    :</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7=""> // 当在 Server 端的时候，将来自 browser 的 headers 携带过去</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-536f64e7="">      // host 也被包含在内。</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">      getProp</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-536f64e7=""> ctx</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-536f64e7="">req</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-536f64e7="">headers</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-536f64e7="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> {}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-536f64e7="">    headers</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">      ...</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-536f64e7="">headers</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">      ...</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-536f64e7="">reqHeaders</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-536f64e7="">,</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7="">  };</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-536f64e7="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">);</span></span></code></pre><p data-v-536f64e7="">这里的 <code data-v-536f64e7="">ctx.req</code> 具体指的就是 <code data-v-536f64e7="">访问主页 /</code> 这次请求。接着，请求被发往 gql-server。</p><p data-v-536f64e7="">这里需要补充一下部署时候的具体情况，<code data-v-536f64e7="">nextjs-ssr</code> 和 <code data-v-536f64e7="">gql-server</code> 运行于 Docker 容器当中，同时在一个物理机上，通过 Nginx 转发请求。</p><p data-v-536f64e7="">那么上述流程会是这样。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span data-v-536f64e7="">1. 访问主页 `http://customer.example.com/`，发送请求到 `nextjs-ssr`</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">    请求内容：</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">      url: http://customer.example.com/</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">      headers:</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">        host:  http://customer.example.com/</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7=""></span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7=""></span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">2. Nginx 将请求转发到 nextjs-ssr，nextjs-ssr 发出 `getInitialProps` 中的请求</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">    请求内容：</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">      url: http://gql-server.example.com/</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">      headers:</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">        host:  http://customer.example.com/</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7=""></span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">3. Nginx 收到请求，发现 host 字段，又将请求转发到 `http://customer.example.com/`</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">    Nginx 默认配置在请求 URL 和 host 字段之间会以 host 优先</span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7=""></span></span>
<span class="line" data-v-536f64e7=""><span data-v-536f64e7="">4. ... 死循环了，最终因为重定向过多，Nginx 返回对应错误码</span></span></code></pre><p data-v-536f64e7="">上述问题的解决很简单，将 host 置空或设置成正确的值。关于 host 字段的作用，我的认识如下。</p><p data-v-536f64e7="">一个域名会被解析成 IP 对应到一台服务器，但这一台服务器上可能存在多个服务，在内部可以通过端口来区分，但出于各种原因，这台服务器往往只对外暴露部分端口，外部访问者这时候就可以额外通过 host 字段告诉服务器想要访问的服务。</p><h2 id="GraphQL%20%E6%9C%8D%E5%8A%A1" data-v-536f64e7="">GraphQL 服务<a name="GraphQL%20%E6%9C%8D%E5%8A%A1" class="headerlink" href="#GraphQL%20%E6%9C%8D%E5%8A%A1" data-v-536f64e7=""></a></h2><p data-v-536f64e7="">GraphQL 的搭建基本是一个学习的过程，虽然写过一些 Node.js 脚本，但对于 Node.js Server 的应用还是知之甚少。</p><p data-v-536f64e7="">在编写完 demo 之后，感觉这个 <code data-v-536f64e7="">gql-server</code> 不算复杂，可能因为这个服务做的事情还是比较纯粹，只提供 GraphQL 服务。</p><p data-v-536f64e7="">各种框架都有对应的方案，可以是 express、koa 等等，这里选择了 fastify，再结合相应的 apollo-server，最后添加 GraphQL 的 schema 即可。</p><p data-v-536f64e7="">以上，都是马后炮 😅。</p><p data-v-536f64e7="">不过值得一提的是，这里有一个库，让 GraphQL 和 TypeScript 的结合变得十分美好。不过在介绍之前，先了解一下痛点。</p><p data-v-536f64e7="">了解过 GraphQL 之后会知道，GraphQL 的一大特点是强类型依赖，所以需要为服务编写很多的类型定义。</p><p data-v-536f64e7="">一开始的时候，老老实实在 graphql 文件中编写 GraphQL 的类型定义。然后，在 TypeScript 中又要写一遍类型定义，显得很重复。而且，写下来后会发现两者十分相似。</p><p data-v-536f64e7="">于是，开始寻找优化方案，从而发现了 <a href="https://github.com/19majkel94/type-graphql" target="_blank" class="" data-v-536f64e7=""><!--[-->type-graphql<!--]--></a>，结合了两者的使用。</p><blockquote data-v-536f64e7=""><p data-v-536f64e7="">提前说明注意点：该库十分依赖装饰器语法和元数据（Decorator Metadata），两者目前为止都还没成为标准，正式使用需慎重。</p></blockquote><p data-v-536f64e7="">在 type-graphql 的基础上，只需要在 TypeScript 中编写 class 即可，class 会被转化为对应的 GraphQL 类型。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#82AAFF;" data-v-536f64e7="">@</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">ObjectType</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">()</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-536f64e7=""> Recipe</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#82AAFF;" data-v-536f64e7="">  @</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">Field</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">type</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-536f64e7=""> ID</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">)</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  id</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7=""> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#82AAFF;" data-v-536f64e7="">  @</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">Field</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">()</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  title</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7=""> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#82AAFF;" data-v-536f64e7="">  @</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">Field</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-536f64e7="">type</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-536f64e7="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> [Rate])</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  ratings</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-536f64e7=""> Rate</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">[];</span></span>
<span class="line" data-v-536f64e7=""></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#82AAFF;" data-v-536f64e7="">  @</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-536f64e7="">Field</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">({ nullable</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-536f64e7="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-536f64e7=""> true</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> })</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  averageRating</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-536f64e7="">?:</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-536f64e7=""> number</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">;</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">}</span></span></code></pre><p data-v-536f64e7="">上面的 class 会被转换成如下的类型。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-536f64e7=""><code data-v-536f64e7=""><span class="line" data-v-536f64e7=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-536f64e7="">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> Recipe</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7=""> {</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  id: ID!</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  title: String!</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  ratings: [Rate!]!</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">  averageRating: Float</span></span>
<span class="line" data-v-536f64e7=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-536f64e7="">}</span></span></code></pre><p data-v-536f64e7="">剩余的、也是主要的工作就是编写 resolvers。</p><h2 id="%E7%BB%93%E8%AF%AD" data-v-536f64e7="">结语<a name="%E7%BB%93%E8%AF%AD" class="headerlink" href="#%E7%BB%93%E8%AF%AD" data-v-536f64e7=""></a></h2><p data-v-536f64e7="">本文也终于到了结束的时候，总感觉还有遗漏的地方，只怪总结得不够及时。</p><p data-v-536f64e7="">本文的 demo 基本是在老大哥（没错，又是那个杰哥）的基础上复刻的，本文最大的意义就是尽可能地将上述内容消化成自己的东西。如果能帮到此时的您，那更是本文的荣幸。</p><p data-v-536f64e7="">对于 SSR 感受还是不错的，首屏的体验也是实打实的；如果觉得添加一个 Node.js 有成本，也十分建议尝试 Prerender，同样能享受到首屏的效果。</p><p data-v-536f64e7="">对于 GraphQL 中间层的感受就有点爱恨交加了。字段查询、接口聚合、返回体自定义（不用忍受后端 😜）等功能都很好用，但是，得有人去维护一个个接口的对接，这一步也只能前端去做。不过总体而言还是很乐意去使用的。</p><p data-v-536f64e7="">本文罗里吧嗦地也写了不少，若发现不当之处，还望斧正，感激不尽！</p><hr data-v-536f64e7=""><p data-v-536f64e7="">参考链接 &amp; 推荐阅读：</p><ul data-v-536f64e7=""><li data-v-536f64e7=""><a href="https://github.com/zeit/next.js" target="_blank" class="" data-v-536f64e7=""><!--[-->Next.js<!--]--></a><ul data-v-536f64e7=""><li data-v-536f64e7=""><a href="https://github.com/zeit/next.js/tree/canary/examples" target="_blank" class="" data-v-536f64e7=""><!--[-->Next.js 官方 examples，十分推荐<!--]--></a></li></ul></li><li data-v-536f64e7=""><a href="https://graphql.org/" target="_blank" class="" data-v-536f64e7=""><!--[-->GraphQL<!--]--></a> - <a href="https://graphql.cn/" target="_blank" class="" data-v-536f64e7=""><!--[-->中文<!--]--></a></li><li data-v-536f64e7=""><a href="https://www.apollographql.com/docs/" target="_blank" class="" data-v-536f64e7=""><!--[-->Apollo GraphQL<!--]--></a><ul data-v-536f64e7=""><li data-v-536f64e7=""><a href="https://github.com/apollographql/react-apollo/" target="_blank" class="" data-v-536f64e7=""><!--[-->Apollo React<!--]--></a></li><li data-v-536f64e7=""><a href="https://github.com/apollographql/apollo-client" target="_blank" class="" data-v-536f64e7=""><!--[-->Apollo Client<!--]--></a></li><li data-v-536f64e7=""><a href="https://github.com/apollographql/apollo-server" target="_blank" class="" data-v-536f64e7=""><!--[-->Apollo Server<!--]--></a></li></ul></li><li data-v-536f64e7=""><a href="https://babeljs.io/docs/en/config-files#project-wide-configuration" target="_blank" class="" data-v-536f64e7=""><!--[-->Babel - Config Files<!--]--></a></li><li data-v-536f64e7=""><a href="https://github.com/fastify/fastify" target="_blank" class="" data-v-536f64e7=""><!--[-->Fastify<!--]--></a></li><li data-v-536f64e7=""><a href="https://stackoverflow.com/questions/43156023/what-is-http-host-header" target="_blank" class="" data-v-536f64e7=""><!--[-->what-is-http-host-header<!--]--></a></li><li data-v-536f64e7=""><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Host" target="_blank" class="" data-v-536f64e7=""><!--[-->Host - MDN<!--]--></a></li></ul><!--]--></div></article><aside class="pointer-events-none fixed z-20 top-0 w-full h-full left-0 overscroll-contain transition-300 lg:pointer-events-auto lg:absolute lg:w-auto lg:bg-transparent lg:left-[calc(100%+clamp(6px,17.1875vw-176px,50px))]" data-v-536f64e7=""><nav class="overflow-y-auto text-foreground overscroll-contain bg-background w-74 max-w-4/5 h-full py-8 px-6 rounded-tl-xl rounded-bl-xl absolute top-0 transition-300 right-0 translate-x-full lg:p-0 lg:max-w-44 xl:max-w-50 lg:h-auto lg:max-h-[calc(100vh-130px)] lg:rounded-none lg:sticky lg:top-10 lg:right-auto lg:translate-x-0 lg:bg-transparent lg:ml-0" data-v-536f64e7=""><h2 class="mb-2 font-bold lg:hidden" data-v-536f64e7="">TABLE OF CONTENTS</h2><ul class="group/root" data-v-536f64e7=""><!--[--><li><a href="#%E7%AE%80%E4%BB%8B" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="简介">简介</span></a><ul class=""><!--[--><li><a href="#nextjs-ssr" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="nextjs-ssr">nextjs-ssr</span></a><!----></li><li><a href="#gql-server" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="gql-server">gql-server</span></a><!----></li><li><a href="#nextjs-static" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="nextjs-static">nextjs-static</span></a><!----></li><!--]--></ul></li><li><a href="#Next.js%20%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="Next.js 使用问题">Next.js 使用问题</span></a><ul class=""><!--[--><li><a href="#%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%84%E7%90%86" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="样式文件的处理">样式文件的处理</span></a><!----></li><li><a href="#%E5%9B%BE%E7%89%87%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="图片等静态文件处理">图片等静态文件处理</span></a><!----></li><li><a href="#Monorepo%20%E4%B8%AD%E7%9A%84%20Babel%20%E9%85%8D%E7%BD%AE" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="Monorepo 中的 Babel 配置">Monorepo 中的 Babel 配置</span></a><!----></li><li><a href="#%E5%9B%BD%E9%99%85%E5%8C%96%E8%AF%AD%E8%A8%80%E6%B8%B2%E6%9F%93%E9%97%AE%E9%A2%98" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="国际化语言渲染问题">国际化语言渲染问题</span></a><!----></li><!--]--></ul></li><li><a href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="其他问题">其他问题</span></a><ul class=""><!--[--><li><a href="#SSR%20%E9%83%A8%E7%BD%B2%E6%9C%9F%E9%97%B4%E7%9A%84%E9%97%AE%E9%A2%98" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="SSR 部署期间的问题">SSR 部署期间的问题</span></a><!----></li><!--]--></ul></li><li><a href="#GraphQL%20%E6%9C%8D%E5%8A%A1" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="GraphQL 服务">GraphQL 服务</span></a><!----></li><li><a href="#%E7%BB%93%E8%AF%AD" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="结语">结语</span></a><!----></li><!--]--></ul></nav></aside></div><hr class="border-border mt-10" data-v-536f64e7=""><div class="mt-10" data-v-536f64e7=""><div data-v-536f64e7=""><h2 class="text-xl font-bold mb-5"><a href="#comment" class="text-accent foreground-link">留言板</a></h2><div class="utterances-wrapper"></div></div></div><!--]--></main><footer class="text-center py-6 text-gray-500 dark:text-gray-400 text-sm"><div><span>© 2017-2025 Daief's Blog</span></div></footer><div></div></div><!--]--></div>
<script>window.__INITIAL_STATE__="{\"naiveUiStyles\":\"\"}"</script>
  

</body></html>