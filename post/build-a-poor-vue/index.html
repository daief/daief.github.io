<!DOCTYPE html><html ssthtmlattrs="" lang="en"><head>
    <title>学写一个乞丐版 Vue | Daief's Blog</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--ssr-head-partial-->
    <script>
      if (/MSIE \d|Trident.*rv:/.test(navigator.userAgent)) {
        // redirect IE to Edge
        // This browser is no longer supported
        window.location.href = 'microsoft-edge:' + window.location.href;
        alert('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
        throw new Error('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
      }
    </script>
    <script type="module" crossorigin="" src="/assets/app-DvX1Smg_.js"></script>
    <link rel="stylesheet" crossorigin="" href="/assets/app-lBf8QYnm.css">
  <link rel="modulepreload" crossorigin="" href="/assets/vm__post_build-a-poor-vue_-DJLyvk_8.js"><link rel="stylesheet" href="/assets/vm__post_build-a-poor-vue_-DezmSAFb.css"><link rel="modulepreload" crossorigin="" href="/assets/meta-info-C-tMy3g2.js"><link rel="modulepreload" crossorigin="" href="/assets/toc-DNILfFl5.js"><link rel="stylesheet" href="/assets/toc-m8VwwUnR.css"><meta name="description" content=""><meta property="og:title" content="学写一个乞丐版 Vue | Daief's Blog"><meta property="og:description" content=""><meta property="og:image" content="https://avatars.githubusercontent.com/u/19222089?v=4"><meta name="author" content="daief"></head>
  <body ssrbodyattrs="">
    <div class="page-bg-gradient pointer-events-none fixed start-0 top-0 z-[-1] h-screen w-full"></div>
    <div id="app" data-server-rendered="true"><!--[--><div class="flex flex-col min-h-screen transition-colors duration-300"><header data-v-c69b61b1=""><div id="nav-container" class="max-w-app mx-auto text-foreground sm:bg-transparent" data-v-c69b61b1=""><div id="top-nav-wrap" class="relative grid grid-cols-2 auto-rows-auto w-full items-center justify-between p-4 sm:py-6 sm:flex sm:grid-rows-1" data-v-c69b61b1=""><a href="/" class="py-1 text-xl leading-8 font-semibold whitespace-nowrap sm:my-auto sm:text-2xl sm:leading-none" data-v-c69b61b1=""><!--[-->Daief's Blog<!--]--></a><div class="flex-center justify-end space-x-4 sm:hidden" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button><a role="button" class="text-2xl p-1" data-v-c69b61b1=""><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em" data-v-c69b61b1=""><path fill="currentColor" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg></a></div><nav id="nav-menu" class="col-start-1 col-end-3 w-full flex-col items-center static top-full left-0 right-0 z-10 mt-4 sm:mt-0 sm:ms-2 sm:flex-row sm:justify-end sm:space-x-4 sm:py-0 sm:flex hidden" data-v-c69b61b1=""><ul id="menu-items" class="w-full place-content-center gap-2 sm:flex sm:w-auto sm:gap-x-5 sm:gap-y-0" data-v-c69b61b1=""><!--[--><li class="col-span-2" data-v-c69b61b1=""><a href="/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1 nav-active" data-v-c69b61b1=""><!--[-->文章<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/tags/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->标签<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/about/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->关于<!--]--></a></li><!--]--><li class="col-span-1 hidden sm:block" data-v-c69b61b1=""><a class="flex justify-center items-center h-full px-4 py-3 sm:px-2 sm:py-1" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button></a></li></ul></nav></div></div><div class="mx-auto max-w-app px-4" data-v-c69b61b1=""><hr class="border-border" aria-hidden="true" data-v-c69b61b1=""></div></header><main class="flex-grow max-w-app mx-auto px-4 py-8 w-full text-foreground"><!--[--><div class="relative" data-v-f15e0aa6=""><article data-v-f15e0aa6=""><header data-v-f15e0aa6=""><h1 class="text-foreground text-3xl font-bold mb-4" data-v-f15e0aa6=""> 学写一个乞丐版 Vue </h1><div class="flex items-center gap-x-3.5 gap-y-0.5 text-foreground opacity-80 flex-wrap" data-v-f15e0aa6=""><!--[--><!--[--><div class="inline-flex items-center gap-x-0.5 whitespace-nowrap"><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M7 11h2v2H7zm14-6v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2M5 7h14V5H5zm14 12V9H5v10zm-4-6v-2h2v2zm-4 0v-2h2v2zm-4 2h2v2H7zm8 2v-2h2v2zm-4 0v-2h2v2z"></path></svg><span>发表于：<time datetime="2020-04-02T13:03:54.000Z">2020/04/02</time></span></div><!--[--><a href="/tags/Vue/1/" class="inline-flex items-center foreground-link"><svg class="iconify-svg block select-none mr-0.5 text-foreground" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="m5.41 21l.71-4h-4l.35-2h4l1.06-6h-4l.35-2h4l.71-4h2l-.71 4h6l.71-4h2l-.71 4h4l-.35 2h-4l-1.06 6h4l-.35 2h-4l-.71 4h-2l.71-4h-6l-.71 4zM9.53 9l-1.06 6h6l1.06-6z"></path></svg>Vue</a><!--]--><!--]--><!--]--></div></header><div class="md-prose max-w-none dark:prose-invert mt-6" data-v-f15e0aa6=""><!--[--><p data-v-f15e0aa6=""><del data-v-f15e0aa6="">没有钱了，肯定要学啊，不学没有钱用。</del></p><p data-v-f15e0aa6=""><del data-v-f15e0aa6="">看源码是不可能看的，这辈子不可能看的。写东西又不会写，就是看这种东西，才能维持得了生活这样子。</del></p><p data-v-f15e0aa6=""><del data-v-f15e0aa6="">什么 Github、掘金、知乎上面个个都是人才，说话又好听，技术又厉害，超喜欢在上面逛的。</del></p><a id="more" href="#more" class="block" data-v-f15e0aa6=""></a><h2 id="%E5%89%8D%E8%A8%80%EF%BC%88%E5%BA%9F%E8%AF%9D%EF%BC%89" data-v-f15e0aa6="">前言（<del data-v-f15e0aa6="">废话</del>）<a name="%E5%89%8D%E8%A8%80%EF%BC%88%E5%BA%9F%E8%AF%9D%EF%BC%89" class="headerlink" href="#%E5%89%8D%E8%A8%80%EF%BC%88%E5%BA%9F%E8%AF%9D%EF%BC%89" data-v-f15e0aa6=""></a></h2><p data-v-f15e0aa6="">对 Vue（v2.x） 的原理也不能说不知道吧，但又解释不太清楚，试着学写一个乞丐版的 Vue 来加深一下理解，同时也想作为后续阅读源码的一个事前准备。老实说这里的内容基本都是参考别人的，但为了回顾以及加深印象，还是再以文章的形式记录一下好了。</p><p data-v-f15e0aa6="">在线 DEMO：<a href="https://codesandbox.io/s/mock-vue-0otdk?fontsize=14&amp;hidenavigation=1&amp;theme=dark" target="_blank" class="" data-v-f15e0aa6=""><!--[-->Edit On CodeSandbox.<!--]--></a></p><p data-v-f15e0aa6="">既然叫作乞丐版，那么自然要有该有的样子：</p><ul data-v-f15e0aa6=""><li data-v-f15e0aa6="">实现基本是按照参考资料以及自己的理解来着；</li><li data-v-f15e0aa6="">尤其是指令、事件绑定那里，自己瞎写写的；</li><li data-v-f15e0aa6="">实现了：<ul data-v-f15e0aa6=""><li data-v-f15e0aa6="">在模板中使用 <code data-v-f15e0aa6=""></code> 并绑定值，支持表达式，但一个节点还只能有一个双大括号插值</li><li data-v-f15e0aa6="">v-model 指令</li><li data-v-f15e0aa6="">v-show、@click 指令，支持表达式</li></ul></li></ul><h2 id="%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0" data-v-f15e0aa6="">编码实现<a name="%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0" class="headerlink" href="#%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0" data-v-f15e0aa6=""></a></h2><p data-v-f15e0aa6="">为了方便编码和阅读，全都用了 <code data-v-f15e0aa6="">class</code> 的写法。</p><p data-v-f15e0aa6="">简易的 Vue 由以下几个部分组成：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span data-v-f15e0aa6="">Vue</span></span>
<span class="line" data-v-f15e0aa6=""><span data-v-f15e0aa6="">├── index.ts</span></span>
<span class="line" data-v-f15e0aa6=""><span data-v-f15e0aa6="">├── Compile.ts</span></span>
<span class="line" data-v-f15e0aa6=""><span data-v-f15e0aa6="">├── Dep.ts</span></span>
<span class="line" data-v-f15e0aa6=""><span data-v-f15e0aa6="">├── Watcher.ts</span></span>
<span class="line" data-v-f15e0aa6=""><span data-v-f15e0aa6="">├── observe.ts</span></span>
<span class="line" data-v-f15e0aa6=""><span data-v-f15e0aa6="">└── utils.ts</span></span></code></pre><h3 id="index" data-v-f15e0aa6="">index<a name="index" class="headerlink" href="#index" data-v-f15e0aa6=""></a></h3><p data-v-f15e0aa6="">定义一个 Vue 的类，像下面这样，保持用法上的一致：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> Vue</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  $el</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> HTMLElement</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  $data</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-f15e0aa6=""> any</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  methods;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">  constructor</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">opts</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> IOption</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">$el</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> document</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">querySelector</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">opts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">el</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">$data</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> opts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">data</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">methods</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> opts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">methods</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> ||</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {};</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    // 使 data 变成响应式</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    observe</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">$data</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    // 使得直接在 Vue 实例上读/写属性时能直接读/写到 $data、methods 中相应的字段</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    proxy</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">this</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    // 解析 DOM 模板并进行渲染</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> Compile</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">$el</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> this</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">}</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">// 使用</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> vm</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> Vue</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6="">{</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  el</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">#app</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  data</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-f15e0aa6=""> 1</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  methods</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    // ...</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">);</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">vm</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">text</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">// 等价于</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">vm</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">$data</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">text</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span></code></pre><h3 id="observe" data-v-f15e0aa6="">observe<a name="observe" class="headerlink" href="#observe" data-v-f15e0aa6=""></a></h3><p data-v-f15e0aa6=""><code data-v-f15e0aa6="">observe</code> 模块将 <code data-v-f15e0aa6="">data</code> 转换成响应式的对象，使用了 <code data-v-f15e0aa6="">Object.defineProperty</code>, 通过 <code data-v-f15e0aa6="">set</code>，<code data-v-f15e0aa6="">get</code> 来设置值与获取值。</p><blockquote data-v-f15e0aa6=""><p data-v-f15e0aa6=""><code data-v-f15e0aa6="">Dep</code> 是观察者模式的应用。</p></blockquote><p data-v-f15e0aa6="">在这里同时借助观察者模式当值发生改变的时候将发出 <code data-v-f15e0aa6="">notify</code> 进行通知。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> observe</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">data</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> Record</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">&lt;</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-f15e0aa6="">string</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-f15e0aa6=""> any</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  for</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">let</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> k</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> in</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> data) {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    defineReactive</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(data</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> k</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> data[k]);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">}</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> defineReactive</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">obj</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> key</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> value</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">  const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> dep</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> Dep</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">();</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  Object</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">defineProperty</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(obj</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> key</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    get</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      Dep</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">target</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> &amp;&amp;</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> dep</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">addSub</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">Dep</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">target</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">      return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> value;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    set</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">newVal</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">      if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> (newVal </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">===</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> value) {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">        return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      }</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      value </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> newVal;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      dep</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">notify</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">();</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    }</span><span style="--shiki-light:#212121;--shiki-dark:#5F7E97;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  });</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">}</span></span></code></pre><blockquote data-v-f15e0aa6=""><p data-v-f15e0aa6="">这里的 <code data-v-f15e0aa6="">Dep.target &amp;&amp; dep.addSub(Dep.target)</code> 是 Vue 中设计比较精妙的一部分，注意到这里是在 getter 中将 Watcher 加入订阅的。 或者这么说，当 <code data-v-f15e0aa6="">Dep.target</code> 有值，这时候若发生取值操作（如，vm.text），<code data-v-f15e0aa6="">Dep.target</code> 就会被加入订阅。</p></blockquote><h3 id="utils" data-v-f15e0aa6="">utils<a name="utils" class="headerlink" href="#utils" data-v-f15e0aa6=""></a></h3><p data-v-f15e0aa6=""><code data-v-f15e0aa6="">utils</code> 下其实就一个方法：<code data-v-f15e0aa6="">expressionToFunction</code>，它的作用可以看作是将一段字符串代码转换成一个函数，并且可以设置这个函数的上下文环境。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> function</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> expressionToFunction</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">exp</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> context</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  // eslint-disable-next-line</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  return</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> Function</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">with(this){return </span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> +</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> exp </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">+</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">}</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">bind</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(context);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">}</span></span></code></pre><p data-v-f15e0aa6="">举个例子：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">// 有一个表达式</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> expression</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> `</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">'hello ' + name</span><span style="--shiki-light:#22863A;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">`</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">window</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">windowName</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> ctx</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">ctxName</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">expressionToFunction</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(expression</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> window)(); </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">// 'hello windowName'</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">expressionToFunction</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(expression</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> ctx)(); </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">// 'hello ctxName'</span></span></code></pre><h3 id="Compile" data-v-f15e0aa6="">Compile<a name="Compile" class="headerlink" href="#Compile" data-v-f15e0aa6=""></a></h3><p data-v-f15e0aa6=""><code data-v-f15e0aa6="">Compile</code> 来解析模板并渲染，对应的理解与说明以注释的形式标注在代码块中了。</p><p data-v-f15e0aa6="">总得来说，根据所给的 DOM 的节点开始向下遍历，逐一进行双括号语法的解析、视图与值的绑定以及指令的相关处理。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> { Watcher } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">./Watcher</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> { expressionToFunction } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">./utils</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> Compile</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  _vm </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-f15e0aa6=""> null</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">  constructor</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">node</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> HTMLElement</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> vm</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-f15e0aa6=""> any</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">_vm</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> vm;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">walkChildren</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(node);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  /**</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">   * 遍历节点，进行解析、绑定、指令的处理</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">   */</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  walkChildren</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> el</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    []</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">slice</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">call</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">el</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">childNodes</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">forEach</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">n</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">      const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> {</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> nodeType</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> }</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> n</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">      // 节点类型为text</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">      if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> (nodeType </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">===</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-f15e0aa6=""> 3</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">) {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">        return</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">compileElement</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(n);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      }</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">      // 注释类型，先不管</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">      if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> (nodeType </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">===</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-f15e0aa6=""> 8</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">) {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">        return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      }</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">      // 元素类型</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">      if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> (nodeType </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">===</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-f15e0aa6=""> 1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">) {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">        this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">parseDirective</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(n);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      }</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">      this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">walkChildren</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(n);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    });</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  };</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  /**</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">   * 文本节点类型，解析双花括号语法，并响应值（data）的变化以进行更新</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">   */</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  compileElement</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">node</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">    const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> reg</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> /</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">\{\{</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">*</span><span style="--shiki-light:#22863A;--shiki-dark:#5CA7E4;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">\}\}</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">/</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">    const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> {</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> nodeValue</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> }</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> node</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">!</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">reg</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">test</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(nodeValue)) {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">      return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    }</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    // 获取双花括号中匹配到的字符串，即表达式</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">    const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> expression</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> RegExp</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">$1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    // 然后对这个表达式实例化一个 Watcher 对象，实现了将 `这个表达式` 与 `表达式中涉及的值` 绑定的操作</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> Watcher</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">_vm</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> expression</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">newV</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> oldV</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">      /**</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">       * 当 `初始化` 以及 `表达式的值变化` 时，这个回调会被触发</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">       * 在这里，将 DOM 上的值进行更新</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">       * 即根据正则将双花括号的内容替换成最终的值</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">       */</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">      // 一些特殊字符需要转义处理</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">      const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> regExpression</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> expression</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">replace</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">/</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">\+</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">|</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">\?</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">|</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">\(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">|</span><span style="--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">\)</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">/</span><span style="--shiki-light:#D32F2F;--shiki-dark:#5CA7E4;" data-v-f15e0aa6="">g</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> _</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-f15e0aa6="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> +</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> _</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">);</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">      const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> replaceReg</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> RegExp</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">{{</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-f15e0aa6="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">s*</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> +</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> regExpression</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> +</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#F78C6C;" data-v-f15e0aa6="">\\</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">s*}}</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      node</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">nodeValue</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> nodeValue</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">replace</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(replaceReg</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> newV);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    });</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  /**</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">   * 指令的处理（大概</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">   */</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  parseDirective</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">node</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">    const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> {</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> attributes</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> }</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> node</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    []</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">slice</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">call</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(attributes </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">||</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> [])</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">forEach</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">attr</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">      /**</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">       * 指令的处理是读取 DOM 上的 attributes 进行逐个解析</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">       * 值同样要作为表达式进行处理</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">       */</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">      const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> {</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> nodeName</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> nodeValue</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> }</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> attr</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">      const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> expression</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> nodeValue</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">      if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> (nodeName </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">===</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">v-model</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">) {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">        /**</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">         * 这里简单实现了一下 v-model</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">         * 监听原生 input 事件，值变化时改变 vm （Vue 实例）上相应的值</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">         * 同时建立一个 Watcher，当值变化时，改变节点的 value</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">         * 从而实现了双向绑定的语法糖</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">         */</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">        node</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">addEventListener</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">input</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> e</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">          // 给相应的 data 属性赋值，进而触发该属性的 set 方法</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">          // 触发 set vm[name]</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">          this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">_vm</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">[nodeValue] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> e</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">target</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">value</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">        });</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">        return</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> Watcher</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">_vm</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> nodeValue</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> val</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">          node</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> val </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">||</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> ''</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">        });</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      } </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">// v-model</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    });</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">}</span></span></code></pre><h3 id="Watcher" data-v-f15e0aa6="">Watcher<a name="Watcher" class="headerlink" href="#Watcher" data-v-f15e0aa6=""></a></h3><p data-v-f15e0aa6="">从上一部分也可以大致看出，<code data-v-f15e0aa6="">Watcher</code> 能够实现对一个表达式的监听，当表达式的值发生变化时触发相应的回调。然后这是 <code data-v-f15e0aa6="">Watcher</code> 的具体实现：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> { Dep } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">./Dep</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> { expressionToFunction } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">./utils</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> Watcher</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  vm;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  expression</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-f15e0aa6=""> string</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  value </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-f15e0aa6=""> null</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  cb;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  getValue;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">  constructor</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">vm</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> expression</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6=""> cb</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">?</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">vm</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> vm;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">expression</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> expression;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">cb</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> cb;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">getValue</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> expressionToFunction</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(expression</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> vm);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">getValue</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">();</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">update</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">();</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  update</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#82AAFF;" data-v-f15e0aa6="">    const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> oldValue</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">value</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">get</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">();</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">cb</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> &amp;&amp;</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">cb</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">value</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> oldValue);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  // 获取 data 的属性值</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  get</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    Dep</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">target</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> this</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    // 触发相应属性的 get</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">getValue</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">();</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    Dep</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">target</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-f15e0aa6=""> null</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">}</span></span></code></pre><p data-v-f15e0aa6=""><code data-v-f15e0aa6="">getValue</code> 是一个方法，用来获取 <code data-v-f15e0aa6="">表达式的值</code>，注意这个属性是通过 <code data-v-f15e0aa6="">expressionToFunction(expression, vm)</code> 得到的，并且这个方法的上下文是 Vue 实例。</p><p data-v-f15e0aa6="">比如说，在模板中有这样的一段：<code data-v-f15e0aa6="">&lt;div&gt;{% raw %}2{% endraw %}&lt;/div&gt;</code>；在 <code data-v-f15e0aa6="">Compile</code> 中解析后的 <code data-v-f15e0aa6="">expression</code> 是这样的 <code data-v-f15e0aa6="">'text % 2 === 0 ? 1 : 2'</code>，经过 <code data-v-f15e0aa6="">expressionToFunction(expression, vm)</code> 处理得到的 <code data-v-f15e0aa6="">getValue</code> 可以认为是这样的：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">getValue</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> ()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  return</span><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> vm</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> %</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-f15e0aa6=""> 2</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> ===</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-f15e0aa6=""> 0</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> ?</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-f15e0aa6=""> 1</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> :</span><span style="--shiki-light:#1976D2;--shiki-dark:#F78C6C;" data-v-f15e0aa6=""> 2</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">};</span></span></code></pre><p data-v-f15e0aa6="">从而调用 <code data-v-f15e0aa6="">getValue</code> 的时候就能获取到对应表达式的值。</p><p data-v-f15e0aa6=""><code data-v-f15e0aa6="">update</code> 方法当接收到 <code data-v-f15e0aa6="">Dep</code> 的通知时会被调用。</p><p data-v-f15e0aa6="">最后就是 <code data-v-f15e0aa6="">get</code> 方法，十分简短：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">Dep</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">target</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> this</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">this</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">getValue</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">();</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">Dep</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">target</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-f15e0aa6=""> null</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span></code></pre><p data-v-f15e0aa6="">此处与 <code data-v-f15e0aa6="">observe</code> 一节中就关联上了，<code data-v-f15e0aa6="">Dep.target</code> 实际上作为一个全局属性用来临时地传值，只是将其设置成了 <code data-v-f15e0aa6="">Dep</code> 的静态属性而已。<code data-v-f15e0aa6="">get</code> 方法就三个步骤：</p><ul data-v-f15e0aa6=""><li data-v-f15e0aa6="">将自身 <code data-v-f15e0aa6="">Watcher</code> 实例赋值给 <code data-v-f15e0aa6="">Dep.target</code>，通过这一点达到目的同时借助了 JavaScript 单线程运行的特点；</li><li data-v-f15e0aa6="">使用 <code data-v-f15e0aa6="">this.getValue()</code> 计算表达式值，结合前面的理解，当这一过程中涉及 <code data-v-f15e0aa6="">vm.xxx</code> 的操作时，<strong data-v-f15e0aa6="">当前 Watcher 将会被加入订阅</strong>；</li><li data-v-f15e0aa6="">释放 <code data-v-f15e0aa6="">Dep.target</code>；</li></ul><h3 id="Dep" data-v-f15e0aa6="">Dep<a name="Dep" class="headerlink" href="#Dep" data-v-f15e0aa6=""></a></h3><p data-v-f15e0aa6="">这是一个简单的观察者模式的实现，写得很简单了，调用 <code data-v-f15e0aa6="">notify</code> 时将会通知到所有的订阅者。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> { Watcher } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">./Watcher</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">export</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> Dep</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  static</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> target</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> Watcher</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> |</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-f15e0aa6=""> null</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-f15e0aa6=""> null</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  subs</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> Set</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6="">Watcher</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">&gt; </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">=</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> Set</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">();</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  addSub</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">sub</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#FFCB8B;" data-v-f15e0aa6=""> Watcher</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">subs</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">add</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(sub);</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  notify</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">    this</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">subs</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">forEach</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-f15e0aa6="">sub</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">      sub</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">update</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">();</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">    });</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  }</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">}</span></span></code></pre><h3 id="%E4%BD%BF%E7%94%A8" data-v-f15e0aa6="">使用<a name="%E4%BD%BF%E7%94%A8" class="headerlink" href="#%E4%BD%BF%E7%94%A8" data-v-f15e0aa6=""></a></h3><p data-v-f15e0aa6="">至此，乞丐版 Vue 的实现大体就完成了，接着就可以假装是一个真正的 Vue 了。</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#CAECE6;" data-v-f15e0aa6="">div</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> id</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">=</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">app</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">"</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">&gt;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">  hello {% raw %}{{ text }}{% endraw %}</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#CAECE6;" data-v-f15e0aa6="">br</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> /&gt;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#CAECE6;" data-v-f15e0aa6="">input</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> v-modle</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">=</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">"</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">text</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">"</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> /&gt;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#CAECE6;" data-v-f15e0aa6="">div</span><span style="--shiki-light:#24292EFF;--shiki-dark:#7FDBCA;" data-v-f15e0aa6="">&gt;</span></span></code></pre><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-f15e0aa6=""><code data-v-f15e0aa6=""><span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6=""> { Vue } </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">./Vue</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> vm</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-f15e0aa6=""> new</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-f15e0aa6=""> Vue</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6="">{</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  el</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">#app</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">  data</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> {</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">    text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">world</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6="">  }</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-f15e0aa6="">,</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-f15e0aa6="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">);</span></span>
<span class="line" data-v-f15e0aa6=""></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">vm</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">text</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">; </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">// world</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">vm</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-f15e0aa6=""> =</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-f15e0aa6="">Vue</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-f15e0aa6="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">;</span></span>
<span class="line" data-v-f15e0aa6=""><span style="--shiki-light:#1976D2;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">vm</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-f15e0aa6="">text</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-f15e0aa6="">; </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-f15e0aa6="">//</span></span></code></pre><h2 id="%E7%BB%93%E8%AF%AD" data-v-f15e0aa6="">结语<a name="%E7%BB%93%E8%AF%AD" class="headerlink" href="#%E7%BB%93%E8%AF%AD" data-v-f15e0aa6=""></a></h2><p data-v-f15e0aa6="">可能都知道 Vue 2 是通过 <code data-v-f15e0aa6="">Object.defineProperty</code> 实现的，但稍微具体一点的细节我其实是不清楚的，这样一次简易的实现过程，让我的认知提高了不少。</p><p data-v-f15e0aa6="">都说这个挺简单的，但一开始看的时候却并不容易看明白，之后自己照着写了一遍才有了一点感觉，还是要多多实践。</p><hr data-v-f15e0aa6=""><p data-v-f15e0aa6="">参考资料：</p><ul data-v-f15e0aa6=""><li data-v-f15e0aa6=""><a href="https://juejin.im/post/5c2202b75188250850606d9c" target="_blank" class="" data-v-f15e0aa6=""><!--[-->实现一个简易的 Vue<!--]--></a></li><li data-v-f15e0aa6=""><a href="https://zhuanlan.zhihu.com/p/29629337" target="_blank" class="" data-v-f15e0aa6=""><!--[-->100 行代码实现一个迷你 Vue<!--]--></a></li></ul><!--]--></div></article><aside class="pointer-events-none fixed z-20 top-0 w-full h-full left-0 overscroll-contain transition-300 lg:pointer-events-auto lg:absolute lg:w-auto lg:bg-transparent lg:left-[calc(100%+clamp(6px,17.1875vw-176px,50px))]" data-v-f15e0aa6=""><nav class="overflow-y-auto text-foreground overscroll-contain bg-background w-74 max-w-4/5 h-full py-8 px-6 rounded-tl-xl rounded-bl-xl absolute top-0 transition-300 right-0 translate-x-full lg:p-0 lg:max-w-44 xl:max-w-50 lg:h-auto lg:max-h-[calc(100vh-130px)] lg:rounded-none lg:sticky lg:top-10 lg:right-auto lg:translate-x-0 lg:bg-transparent lg:ml-0" data-v-f15e0aa6=""><h2 class="mb-2 font-bold lg:hidden" data-v-f15e0aa6="">TABLE OF CONTENTS</h2><ul class="group/root" data-v-f15e0aa6=""><!--[--><li><a href="#%E5%89%8D%E8%A8%80%EF%BC%88%E5%BA%9F%E8%AF%9D%EF%BC%89" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="前言（废话）">前言（废话）</span></a><!----></li><li><a href="#%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="编码实现">编码实现</span></a><ul class=""><!--[--><li><a href="#index" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="index">index</span></a><!----></li><li><a href="#observe" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="observe">observe</span></a><!----></li><li><a href="#utils" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="utils">utils</span></a><!----></li><li><a href="#Compile" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="Compile">Compile</span></a><!----></li><li><a href="#Watcher" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="Watcher">Watcher</span></a><!----></li><li><a href="#Dep" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="Dep">Dep</span></a><!----></li><li><a href="#%E4%BD%BF%E7%94%A8" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="使用">使用</span></a><!----></li><!--]--></ul></li><li><a href="#%E7%BB%93%E8%AF%AD" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="结语">结语</span></a><!----></li><!--]--></ul></nav></aside></div><hr class="border-border mt-10" data-v-f15e0aa6=""><div class="mt-10" data-v-f15e0aa6=""><div data-v-f15e0aa6=""><h2 class="text-xl font-bold mb-5"><a href="#comment" class="text-accent foreground-link">留言板</a></h2><div class="utterances-wrapper"></div></div></div><!--]--></main><footer class="text-center py-6 text-gray-500 dark:text-gray-400 text-sm"><div><span>© 2017-2025 Daief's Blog</span></div></footer><div></div></div><!--]--></div>
<script>window.__INITIAL_STATE__="{\"naiveUiStyles\":\"\"}"</script>
  

</body></html>