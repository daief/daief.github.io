<!DOCTYPE html><html ssthtmlattrs="" lang="en"><head>
    <title>TS transformer 的使用 | Daief's Blog</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--ssr-head-partial-->
    <script>
      if (/MSIE \d|Trident.*rv:/.test(navigator.userAgent)) {
        // redirect IE to Edge
        // This browser is no longer supported
        window.location.href = 'microsoft-edge:' + window.location.href;
        alert('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
        throw new Error('请使用 Chrome/Edge/Firefox/Safari 等现代浏览器。');
      }
    </script>
    <script type="module" crossorigin="" src="/assets/app-DvX1Smg_.js"></script>
    <link rel="stylesheet" crossorigin="" href="/assets/app-lBf8QYnm.css">
  <link rel="modulepreload" crossorigin="" href="/assets/vm__post_usage-of-ts-transformer_-DLn8zNqp.js"><link rel="stylesheet" href="/assets/vm__post_usage-of-ts-transformer_-BdSVrnWY.css"><link rel="modulepreload" crossorigin="" href="/assets/meta-info-C-tMy3g2.js"><link rel="modulepreload" crossorigin="" href="/assets/toc-DNILfFl5.js"><link rel="stylesheet" href="/assets/toc-m8VwwUnR.css"><meta name="description" content=""><meta property="og:title" content="TS transformer 的使用 | Daief's Blog"><meta property="og:description" content=""><meta property="og:image" content="https://avatars.githubusercontent.com/u/19222089?v=4"><meta name="author" content="daief"></head>
  <body ssrbodyattrs="">
    <div class="page-bg-gradient pointer-events-none fixed start-0 top-0 z-[-1] h-screen w-full"></div>
    <div id="app" data-server-rendered="true"><!--[--><div class="flex flex-col min-h-screen transition-colors duration-300"><header data-v-c69b61b1=""><div id="nav-container" class="max-w-app mx-auto text-foreground sm:bg-transparent" data-v-c69b61b1=""><div id="top-nav-wrap" class="relative grid grid-cols-2 auto-rows-auto w-full items-center justify-between p-4 sm:py-6 sm:flex sm:grid-rows-1" data-v-c69b61b1=""><a href="/" class="py-1 text-xl leading-8 font-semibold whitespace-nowrap sm:my-auto sm:text-2xl sm:leading-none" data-v-c69b61b1=""><!--[-->Daief's Blog<!--]--></a><div class="flex-center justify-end space-x-4 sm:hidden" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button><a role="button" class="text-2xl p-1" data-v-c69b61b1=""><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em" data-v-c69b61b1=""><path fill="currentColor" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg></a></div><nav id="nav-menu" class="col-start-1 col-end-3 w-full flex-col items-center static top-full left-0 right-0 z-10 mt-4 sm:mt-0 sm:ms-2 sm:flex-row sm:justify-end sm:space-x-4 sm:py-0 sm:flex hidden" data-v-c69b61b1=""><ul id="menu-items" class="w-full place-content-center gap-2 sm:flex sm:w-auto sm:gap-x-5 sm:gap-y-0" data-v-c69b61b1=""><!--[--><li class="col-span-2" data-v-c69b61b1=""><a href="/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1 nav-active" data-v-c69b61b1=""><!--[-->文章<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/tags/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->标签<!--]--></a></li><li class="col-span-2" data-v-c69b61b1=""><a href="/about/" class="flex justify-center items-center h-full px-4 py-3 font-medium hover:text-accent sm:px-2 sm:py-1" data-v-c69b61b1=""><!--[-->关于<!--]--></a></li><!--]--><li class="col-span-1 hidden sm:block" data-v-c69b61b1=""><a class="flex justify-center items-center h-full px-4 py-3 sm:px-2 sm:py-1" data-v-c69b61b1=""><button class="cursor-pointer relative" data-v-c69b61b1=""><div class="w-10 h-6 rounded-3xl border-[3px] border-[#d1d5da] transition-300 dark:border-[#6E40C9]"><div class="absolute top-1/2 -left-0.5 transform -translate-y-1/2 transition-300 w-[28px] h-[28px] bg-[#2f363d] rounded-full flex-center dark:bg-[#6E40C9] dark:left-[calc(100%-28px+2px)]"><span class="text-[16px]"><!--?xml version="1.0" standalone="no"?-->
<svg t="1761650889094" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2362" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
  <path d="M554.632 298.914h-85.264c-11.782 0-21.344-9.546-21.344-21.328s9.562-21.328 21.344-21.328h85.264c11.81 0 21.374 9.546 21.374 21.328s-9.562 21.328-21.374 21.328z" fill="#F6BB42" p-id="2363"></path>
  <path d="M810.562 725.43c-282.664 0-511.812-229.164-511.812-511.826 0-63.53 11.594-124.372 32.748-180.51C137.91 106.076 0.196 293.04 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 219.102 0 406.096-137.714 479.034-331.302-56.126 21.156-116.934 32.748-180.496 32.748z" fill="#FFCE54" p-id="2364"></path>
  <path d="M554.632 981.328c-282.632 0-511.78-229.148-511.78-511.812 0-130.434 48.81-249.476 129.122-339.848C66.6 223.416 0.196 360.02 0.196 512.172c0 282.662 229.15 511.812 511.828 511.812 152.106 0 288.726-66.406 382.47-171.806-90.368 80.368-209.43 129.15-339.862 129.15z" fill="#F6BB42" p-id="2365"></path>
  <path d="M767.938 277.586c0 11.782-9.562 21.328-21.376 21.328-11.75 0-21.312-9.546-21.312-21.328s9.562-21.328 21.312-21.328c11.814 0 21.376 9.546 21.376 21.328z" fill="#4A89DC" p-id="2366"></path>
  <path d="M661.316 490.844c0 11.766-9.562 21.328-21.374 21.328-11.75 0-21.312-9.562-21.312-21.328 0-11.782 9.562-21.328 21.312-21.328 11.812 0 21.374 9.546 21.374 21.328z" fill="#48CFAD" p-id="2367"></path>
  <path d="M1023.804 234.586c0 11.782-9.562 21.328-21.312 21.328-11.748 0-21.31-9.546-21.31-21.328 0-11.78 9.562-21.326 21.31-21.326 11.75 0 21.312 9.546 21.312 21.326z" fill="#ED5564" p-id="2368"></path>
  <path d="M639.944 21.328c0 11.782-9.5 21.328-21.312 21.328-11.75 0-21.312-9.546-21.312-21.328 0-11.766 9.562-21.312 21.312-21.312a21.288 21.288 0 0 1 21.312 21.312z" fill="#AC92EB" p-id="2369"></path>
  <path d="M512.024 192.276c-11.782 0-21.344 9.562-21.344 21.328v127.964c0 11.766 9.562 21.312 21.344 21.312 11.75 0 21.312-9.546 21.312-21.312v-127.964c0-11.766-9.562-21.328-21.312-21.328z" fill="#FFCE54" p-id="2370"></path>
  <path d="M874.56 426.862c-11.812 0-21.312 9.546-21.312 21.328v127.934c0 11.812 9.5 21.344 21.312 21.344 11.748 0 21.308-9.532 21.308-21.344v-127.934c0.002-11.78-9.56-21.328-21.308-21.328z" fill="#F6BB42" p-id="2371"></path>
  <path d="M917.182 533.484h-85.306c-11.75 0-21.312-9.546-21.312-21.312 0-11.782 9.562-21.328 21.312-21.328h85.306c11.812 0 21.312 9.546 21.312 21.328 0 11.766-9.5 21.312-21.312 21.312z" fill="#FFCE54" p-id="2372"></path>
</svg>
</span></div></div></button></a></li></ul></nav></div></div><div class="mx-auto max-w-app px-4" data-v-c69b61b1=""><hr class="border-border" aria-hidden="true" data-v-c69b61b1=""></div></header><main class="flex-grow max-w-app mx-auto px-4 py-8 w-full text-foreground"><!--[--><div class="relative" data-v-4ad3f6b4=""><article data-v-4ad3f6b4=""><header data-v-4ad3f6b4=""><h1 class="text-foreground text-3xl font-bold mb-4" data-v-4ad3f6b4=""> TS transformer 的使用 </h1><div class="flex items-center gap-x-3.5 gap-y-0.5 text-foreground opacity-80 flex-wrap" data-v-4ad3f6b4=""><!--[--><!--[--><div class="inline-flex items-center gap-x-0.5 whitespace-nowrap"><svg class="iconify-svg block" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M7 11h2v2H7zm14-6v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2M5 7h14V5H5zm14 12V9H5v10zm-4-6v-2h2v2zm-4 0v-2h2v2zm-4 2h2v2H7zm8 2v-2h2v2zm-4 0v-2h2v2z"></path></svg><span>发表于：<time datetime="2020-01-26T13:07:08.000Z">2020/01/26</time></span></div><!--[--><a href="/tags/TypeScript/1/" class="inline-flex items-center foreground-link"><svg class="iconify-svg block select-none mr-0.5 text-foreground" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="m5.41 21l.71-4h-4l.35-2h4l1.06-6h-4l.35-2h4l.71-4h2l-.71 4h6l.71-4h2l-.71 4h4l-.35 2h-4l-1.06 6h4l-.35 2h-4l-.71 4h-2l.71-4h-6l-.71 4zM9.53 9l-1.06 6h6l1.06-6z"></path></svg>TypeScript</a><!--]--><!--]--><!--]--></div></header><div class="md-prose max-w-none dark:prose-invert mt-6" data-v-4ad3f6b4=""><!--[--><p data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">TS transformer</code> 简单来讲就像<a href="https://babeljs.io/docs/en/plugins/" target="_blank" class="" data-v-4ad3f6b4=""><!--[-->babel 插件<!--]--></a>一样，只不过作用于 TypeScript 的编译过程。</p><p data-v-4ad3f6b4="">与 babel 插件不同的是，配置 transformer 的时候会有 <code data-v-4ad3f6b4="">before</code>、<code data-v-4ad3f6b4="">after</code>、<code data-v-4ad3f6b4="">afterDeclarations</code> 这三种选项，如果不清楚他们之前的区别的话，使用的时候会充满困惑。</p><p data-v-4ad3f6b4="">本文只关注 transformer 的使用，对应的 demo 仓库：<a href="https://github.com/daief/usage-of-ts-transformer" target="_blank" class="" data-v-4ad3f6b4=""><!--[-->https://github.com/daief/usage-of-ts-transformer<!--]--></a>。</p><a id="more" href="#more" class="block" data-v-4ad3f6b4=""></a><h2 id="%E9%85%8D%E7%BD%AE%20transformer" data-v-4ad3f6b4="">配置 transformer<a name="%E9%85%8D%E7%BD%AE%20transformer" class="headerlink" href="#%E9%85%8D%E7%BD%AE%20transformer" data-v-4ad3f6b4=""></a></h2><p data-v-4ad3f6b4="">想要使用 transformer 有多种方式，常见的有：</p><ul data-v-4ad3f6b4=""><li data-v-4ad3f6b4="">配合 <a href="https://github.com/TypeStrong/ts-loader#getcustomtransformers" target="_blank" class="" data-v-4ad3f6b4=""><!--[-->ts-loader<!--]--></a></li><li data-v-4ad3f6b4="">配合 <a href="https://github.com/s-panferov/awesome-typescript-loader#getcustomtransformers-string--program-tsprogram--tscustomtransformers--undefined-defaultundefined" target="_blank" class="" data-v-4ad3f6b4=""><!--[-->awesome-typescript-loader<!--]--></a></li><li data-v-4ad3f6b4="">配合 <a href="https://github.com/ivogabe/gulp-typescript#custom-transforms" target="_blank" class="" data-v-4ad3f6b4=""><!--[-->gulp-typescript<!--]--></a></li></ul><p data-v-4ad3f6b4="">而这里只是作为简单演示，则是直接使用了 <a href="https://www.npmjs.com/package/typescript" target="_blank" class="" data-v-4ad3f6b4=""><!--[-->typescript<!--]--></a>：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">// index.ts</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">import</span><span style="--shiki-light:#1976D2;--shiki-dark:#82AAFF;" data-v-4ad3f6b4=""> *</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> ts </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">typescript</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">/**</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> * 自定义 transformer</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> */</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">const</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> RenameTransformerFactory</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">TransformerFactory</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#5F7E97;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">SourceFile</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">&gt;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> (</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  context</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  // ...... 暂时省略</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">// Create the TS program.</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> program</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">createProgram</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">([</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">src/index.ts</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  target</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">ScriptTarget</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">ES5</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  module</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">ModuleKind</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">CommonJS</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  declaration</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> true</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  outDir</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">lib</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">);</span></span>
<span class="line" data-v-4ad3f6b4=""></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">// emit compile</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> emitResult</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> program</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">emit</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  before</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> [</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">RenameTransformerFactory</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> // 使用 transformer</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  after</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> []</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  afterDeclarations</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> []</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">);</span></span></code></pre><h2 id="%E4%BD%BF%E7%94%A8%E6%97%B6%E6%9C%BA" data-v-4ad3f6b4="">使用时机<a name="%E4%BD%BF%E7%94%A8%E6%97%B6%E6%9C%BA" class="headerlink" href="#%E4%BD%BF%E7%94%A8%E6%97%B6%E6%9C%BA" data-v-4ad3f6b4=""></a></h2><p data-v-4ad3f6b4="">在上述代码片段中可以看到，将 transformer 传入到了 <code data-v-4ad3f6b4="">before</code>，同时还有 <code data-v-4ad3f6b4="">after</code> 和 <code data-v-4ad3f6b4="">afterDeclarations</code> 可供选择，而三者的区别参阅的资料如下：</p><blockquote data-v-4ad3f6b4=""><p data-v-4ad3f6b4="">TS itself comes with <a href="https://github.com/Microsoft/TypeScript/tree/master/src/compiler/transformers" target="_blank" class="" data-v-4ad3f6b4=""><!--[-->a lot of ESNext -&gt; ES5<!--]--></a> transformers by default. The pipeline allows you to order your custom transformer in a specific way:</p><ol data-v-4ad3f6b4=""><li data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">before</code> means your transformers get run before TS ones, which means your transformer will get raw TS syntax instead of transpiled syntax (e.g <code data-v-4ad3f6b4="">import</code> instead of <code data-v-4ad3f6b4="">require</code> or <code data-v-4ad3f6b4="">define</code>)</li><li data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">after</code> means your transformers get run after TS ones, which gets transpiled syntax.</li><li data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">afterDeclarations</code> means your transformers get run during <code data-v-4ad3f6b4="">d.ts</code> generation phase, allowing you to transform output type declarations.</li></ol></blockquote><p data-v-4ad3f6b4="">我个人基于此的理解是这样的：</p><p data-v-4ad3f6b4="">TS 自身具有强大的编译功能，如将 <code data-v-4ad3f6b4="">ESNext</code> 语法降级、<code data-v-4ad3f6b4="">ESModule</code> 语法转换为 <code data-v-4ad3f6b4="">CommonJS</code> 规范。</p><p data-v-4ad3f6b4="">假设有这样的一个转换场景：源码使用的是 <code data-v-4ad3f6b4="">ESModule</code> 规范，<code data-v-4ad3f6b4="">tsconfig</code> 中指定了 <code data-v-4ad3f6b4="">module</code> 为 <code data-v-4ad3f6b4="">commonjs</code>。</p><ul data-v-4ad3f6b4=""><li data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">before</code>：指定在此阶段的 transformer，运行于 TS 自身的编译功能之前。transformer 基于的是最初输入的抽象语法树（AST），也就是说此时可以在 AST 找到 <code data-v-4ad3f6b4="">import</code> 等与 <code data-v-4ad3f6b4="">ESModule</code> 相关的节点。</li><li data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">after</code>：此阶段的 transformer 运行于 TS 编译之后，因为上面指定了输出为 <code data-v-4ad3f6b4="">commonjs</code> 规范，同时代表此处的 transformer 已经读取不到 <code data-v-4ad3f6b4="">ESModule</code> 相关的节点了，只能获取到 <code data-v-4ad3f6b4="">require</code> 等信息。</li><li data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">afterDeclarations</code>：则是作用于 <code data-v-4ad3f6b4="">d.ts</code> 类型文件生成的阶段，只影响类型文件的生成。</li></ul><p data-v-4ad3f6b4="">文字的描述显得苍白、费解，接着会分别看一下实际效果来帮助理解，但在那之前先简单介绍一下演示中的 transformer：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">/**</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> * 定义一个简单的 transformer，作用是：</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> *  - before/afterDeclarations：将 import 语句中的模块名改成 `renamed-lib-name`</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> *  - after：将 `"use strict";` 语句改为 `"use strict"; // use strict`</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> */</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">const</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> RenameTransformerFactory</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">TransformerFactory</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#5F7E97;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">SourceFile</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">&gt;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> (</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  context</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> (</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">node</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">    const</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> visitor</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">Visitor</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> (</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">node</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">Node</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#7FDBCA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">VisitResult</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#5F7E97;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">ts</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">Node</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">&gt;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">      if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> (</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        node</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">parent</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> &amp;&amp;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        ts</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">isImportDeclaration</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">node</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">parent</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> &amp;&amp;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        node</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">parent</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">moduleSpecifier</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> ===</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> node</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">      )</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        // 更新 import</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        return</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">createStringLiteral</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">renamed-lib-name</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">      }</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> else</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> (</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        ts</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">isExpressionStatement</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">node</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> &amp;&amp;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        ts</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">isStringLiteral</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">node</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">expression</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> &amp;&amp;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        node</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">expression</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> ===</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">use strict</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">      )</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        // 添加注释</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">        return</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">createIdentifier</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">"use strict"; // use strict</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">      }</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">      return</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">visitEachChild</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">node</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> visitor</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> context</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">    };</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">    return</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> ts</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">visitNode</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">node</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> visitor</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">  };</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span></code></pre><p data-v-4ad3f6b4="">作为输入的源文件内容如下，<code data-v-4ad3f6b4="">src/index.ts</code>：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">// @ts-ignore</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> value </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">some-lib</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">export</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> value;</span></span></code></pre><h3 id="before" data-v-4ad3f6b4="">before<a name="before" class="headerlink" href="#before" data-v-4ad3f6b4=""></a></h3><p data-v-4ad3f6b4="">只在 before 中使用，按照如下更改代码：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">// emit compile</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> emitResult</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> program</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">emit</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  before</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> [</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">RenameTransformerFactory</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  // after: [RenameTransformerFactory],</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  // afterDeclarations: [RenameTransformerFactory]</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">);</span></span></code></pre><p data-v-4ad3f6b4="">然后运行编译（运行 <code data-v-4ad3f6b4="">yarn compile</code>），查看 <code data-v-4ad3f6b4="">lib</code> 下的结果文件。</p><p data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">lib/index.js</code>：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">use strict</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">Object</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">defineProperty</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-4ad3f6b4="">exports</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">__esModule</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> { value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-4ad3f6b4=""> true</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> });</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">// @ts-ignore</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">var</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-4ad3f6b4=""> some_lib_1</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">renamed-lib-name</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">);</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-4ad3f6b4="">exports</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-4ad3f6b4="">default</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> some_lib_1</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-4ad3f6b4="">default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span></code></pre><p data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">lib/index.d.ts</code>：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> value </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">some-lib</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">export</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> value;</span></span></code></pre><p data-v-4ad3f6b4=""><strong data-v-4ad3f6b4="">可以看到，transformer 生效将 <code data-v-4ad3f6b4="">some-lib</code> 改成了 <code data-v-4ad3f6b4="">renamed-lib-name</code>；但是输出的类型文件中依旧是 <code data-v-4ad3f6b4="">import value from 'some-lib'</code></strong>。</p><h3 id="after" data-v-4ad3f6b4="">after<a name="after" class="headerlink" href="#after" data-v-4ad3f6b4=""></a></h3><p data-v-4ad3f6b4="">更新代码如下并编译：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> emitResult</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> program</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">emit</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  // before: [RenameTransformerFactory],</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  after</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> [</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">RenameTransformerFactory</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  // afterDeclarations: [RenameTransformerFactory]</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">);</span></span></code></pre><p data-v-4ad3f6b4="">查看结果。</p><p data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">lib/index.js</code>：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">use strict</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">; </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">// use strict</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">Object</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">defineProperty</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-4ad3f6b4="">exports</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">__esModule</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> { value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-4ad3f6b4=""> true</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> });</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">// @ts-ignore</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">var</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-4ad3f6b4=""> some_lib_1</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">some-lib</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">);</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-4ad3f6b4="">exports</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-4ad3f6b4="">default</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> some_lib_1</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-4ad3f6b4="">default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span></code></pre><p data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">lib/index.d.ts</code>：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> value </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">some-lib</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">export</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> value;</span></span></code></pre><p data-v-4ad3f6b4=""><strong data-v-4ad3f6b4="">这一次发现，注释成功添加上了，但是 <code data-v-4ad3f6b4="">some-lib</code> 没有发生变化，类型文件也毫无变化。</strong></p><p data-v-4ad3f6b4="">如前文所述，此时将插件作用到了 <code data-v-4ad3f6b4="">after</code>，此时已经经过了 TS 自身的转换，已经转换成 <code data-v-4ad3f6b4="">commonjs</code> 模块了，而更新 <code data-v-4ad3f6b4="">some-lib</code> 是基于查找 <code data-v-4ad3f6b4="">ImportDeclaration</code> 类型的节点的，此时自然就找不到、也做不了修改了；同时经过 TS 自身编译后的会在文件头部添加 <code data-v-4ad3f6b4="">use strict</code>，因此 transformer 中第二个判断逻辑得以找到符合要求的节点并添加了注释。</p><h3 id="afterDeclarations" data-v-4ad3f6b4="">afterDeclarations<a name="afterDeclarations" class="headerlink" href="#afterDeclarations" data-v-4ad3f6b4=""></a></h3><p data-v-4ad3f6b4="">同样，更新代码使得插件作用于 <code data-v-4ad3f6b4="">afterDeclarations</code>，并查看结果：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">const</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> emitResult</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> program</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">emit</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> undefined</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> {</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  // before: [RenameTransformerFactory],</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  // after: [RenameTransformerFactory]</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">  afterDeclarations</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> [</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">RenameTransformerFactory</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">]</span><span style="--shiki-light:#212121;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">,</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#24292EFF;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">}</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">);</span></span></code></pre><p data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">lib/index.js</code>：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">use strict</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">Object</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">defineProperty</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-4ad3f6b4="">exports</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">__esModule</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#212121;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> { value</span><span style="--shiki-light:#D32F2F;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#FF5874;" data-v-4ad3f6b4=""> true</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> });</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">// @ts-ignore</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4="">var</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D7DBE0;" data-v-4ad3f6b4=""> some_lib_1</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> require</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">(</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">some-lib</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">);</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#1976D2;--shiki-dark:#C5E478;" data-v-4ad3f6b4="">exports</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-4ad3f6b4="">default</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C792EA;" data-v-4ad3f6b4=""> =</span><span style="--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> some_lib_1</span><span style="--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#BAEBE2;" data-v-4ad3f6b4="">default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span></code></pre><p data-v-4ad3f6b4=""><code data-v-4ad3f6b4="">lib/index.d.ts</code>：</p><pre class="shiki shiki-themes min-light night-owl" style="--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627;" tabindex="0" data-v-4ad3f6b4=""><code data-v-4ad3f6b4=""><span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> value </span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">from</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4=""> '</span><span style="--shiki-light:#22863A;--shiki-dark:#ECC48D;" data-v-4ad3f6b4="">renamed-lib-name</span><span style="--shiki-light:#22863A;--shiki-dark:#D9F5DD;" data-v-4ad3f6b4="">'</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4="">;</span></span>
<span class="line" data-v-4ad3f6b4=""><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4="">export</span><span style="--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic;" data-v-4ad3f6b4=""> default</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D6DEEB;" data-v-4ad3f6b4=""> value;</span></span></code></pre><p data-v-4ad3f6b4=""><strong data-v-4ad3f6b4="">可以看到只有 <code data-v-4ad3f6b4="">d.ts</code> 类型文件中体现了 transformer 的修改。所以，当需要通过 AST 干涉类型文件的生成时，就要在 afterDeclarations 中指定 transformer。</strong></p><h2 id="%E7%BB%93%E8%AF%AD" data-v-4ad3f6b4="">结语<a name="%E7%BB%93%E8%AF%AD" class="headerlink" href="#%E7%BB%93%E8%AF%AD" data-v-4ad3f6b4=""></a></h2><p data-v-4ad3f6b4="">至此，对 TS transformer 的使用总算有了一个大体的认识。忍不住想吐槽一下，TS 的 transformer 在使用上相比 babel 插件要麻烦好多啊~</p><p data-v-4ad3f6b4="">另外，<code data-v-4ad3f6b4="">afterDeclarations</code> 是在这一次的学习中意外发现的，了解到 transformer 干涉类型文件的正确姿势。</p><p data-v-4ad3f6b4="">实际上之前查阅过多次 transformer 修改类型文件输出的内容，但总是无果（感觉资料也少、又英文居多 😅...）。</p><p data-v-4ad3f6b4="">all in all，这次学习了新知识的同时还解开了一个一直以来的小心结，内心十分舒坦。</p><p data-v-4ad3f6b4="">最后，今天是新年初二，祝您新年快乐，鼠年大吉，平平安安，快快乐乐，万事如意~</p><p data-v-4ad3f6b4="">也希望能早日战胜疫情，武汉加油！中国加油！</p><hr data-v-4ad3f6b4=""><p data-v-4ad3f6b4="">参考资料 &amp; 相关阅读</p><ul data-v-4ad3f6b4=""><li data-v-4ad3f6b4=""><a href="https://levelup.gitconnected.com/writing-typescript-custom-ast-transformer-part-1-7585d6916819" target="_blank" class="" data-v-4ad3f6b4=""><!--[-->Writing TypeScript custom AST Transformer (Part 1)<!--]--></a></li><li data-v-4ad3f6b4=""><a href="https://github.com/Microsoft/TypeScript/issues/29543" target="_blank" class="" data-v-4ad3f6b4=""><!--[-->custom transformer in afterDeclarations cannot transform declaration files<!--]--></a></li></ul><!--]--></div></article><aside class="pointer-events-none fixed z-20 top-0 w-full h-full left-0 overscroll-contain transition-300 lg:pointer-events-auto lg:absolute lg:w-auto lg:bg-transparent lg:left-[calc(100%+clamp(6px,17.1875vw-176px,50px))]" data-v-4ad3f6b4=""><nav class="overflow-y-auto text-foreground overscroll-contain bg-background w-74 max-w-4/5 h-full py-8 px-6 rounded-tl-xl rounded-bl-xl absolute top-0 transition-300 right-0 translate-x-full lg:p-0 lg:max-w-44 xl:max-w-50 lg:h-auto lg:max-h-[calc(100vh-130px)] lg:rounded-none lg:sticky lg:top-10 lg:right-auto lg:translate-x-0 lg:bg-transparent lg:ml-0" data-v-4ad3f6b4=""><h2 class="mb-2 font-bold lg:hidden" data-v-4ad3f6b4="">TABLE OF CONTENTS</h2><ul class="group/root" data-v-4ad3f6b4=""><!--[--><li><a href="#%E9%85%8D%E7%BD%AE%20transformer" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="配置 transformer">配置 transformer</span></a><!----></li><li><a href="#%E4%BD%BF%E7%94%A8%E6%97%B6%E6%9C%BA" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="使用时机">使用时机</span></a><ul class=""><!--[--><li><a href="#before" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="before">before</span></a><!----></li><li><a href="#after" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="after">after</span></a><!----></li><li><a href="#afterDeclarations" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:16px;margin-right:12px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="afterDeclarations">afterDeclarations</span></a><!----></li><!--]--></ul></li><li><a href="#%E7%BB%93%E8%AF%AD" class="group/item text-foreground flex flex-nowrap items-center mb-1.5"><span class="hidden lg:block h-1 bg-foreground rounded-sm opacity-30 transition-300 shrink-0 group-hover/item:opacity-85" style="width:20px;margin-right:8px;"></span><span class="opacity-100 text-[color-mix(in_srgb,var(--foreground)_70%,transparent)] text-sm overflow-hidden text-ellipsis whitespace-nowrap transition-300 max-w-full flex-grow lg:opacity-0 lg:max-w-46 group-hover/root:opacity-100 group-hover/item:text-foreground lg:opacity-0" title="结语">结语</span></a><!----></li><!--]--></ul></nav></aside></div><hr class="border-border mt-10" data-v-4ad3f6b4=""><div class="mt-10" data-v-4ad3f6b4=""><div data-v-4ad3f6b4=""><h2 class="text-xl font-bold mb-5"><a href="#comment" class="text-accent foreground-link">留言板</a></h2><div class="utterances-wrapper"></div></div></div><!--]--></main><footer class="text-center py-6 text-gray-500 dark:text-gray-400 text-sm"><div><span>© 2017-2025 Daief's Blog</span></div></footer><div></div></div><!--]--></div>
<script>window.__INITIAL_STATE__="{\"naiveUiStyles\":\"\"}"</script>
  

</body></html>